<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#0f380f" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>í•˜ë£¨ì¹˜ - í–„ìŠ¤í„° ë‹¤ë§ˆê³ ì¹˜ ğŸ¹</title>
  <link rel="icon" type="image/png" href="assets/hamster/normal.png">

  <!-- ë§í¬ ê³µìœ  ì‹œ ë¯¸ë¦¬ë³´ê¸° (ì¹´í†¡, SNS ë“±) -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="í•˜ë£¨ì¹˜ - í–„ìŠ¤í„° ë‹¤ë§ˆê³ ì¹˜ ğŸ¹" />
  <meta property="og:description" content="ê·€ì—¬ìš´ í–„ìŠ¤í„° í•˜ë£¨ì¹˜ë¥¼ í‚¤ì›Œë³´ì„¸ìš”! ë°¥ ì£¼ê¸°, ë¬¼ ì£¼ê¸°, ì“°ë‹¤ë“¬ê¸°ë¡œ ë ˆë²¨ì—…!" />
  <meta property="og:image" content="/assets/Thumbnail_og.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="822" />
  <meta property="og:locale" content="ko_KR" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="í•˜ë£¨ì¹˜ - í–„ìŠ¤í„° ë‹¤ë§ˆê³ ì¹˜ ğŸ¹" />
  <meta name="twitter:image" content="/assets/Thumbnail_og.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <script>
    /* === ê¸°ë³¸/í”„ë¡œ ë²„ì „ êµ¬ë¶„ (ë°°í¬ URL ê¸°ì¤€) ===
     * - basic (1000ì›): haruchi.vercel.app ë“±
     * - pro (5000ì›): haruchipro.vercel.app, haruchi-pro.vercel.app ë“± hostnameì— pro í¬í•¨
     * - ë¡œì»¬ í…ŒìŠ¤íŠ¸: ?tier=pro ë¡œ í”„ë¡œ ê¸°ëŠ¥ í™•ì¸ */
    window.APP_TIER = (function(){
      if (typeof location === 'undefined') return 'basic';
      if (location.search.includes('tier=pro')) return 'pro';
      var h = location.hostname || '';
      if (h.includes('haruchipro') || h.includes('-pro') || h.includes('.pro.')) return 'pro';
      return 'basic';
    })();
    window.IS_PRO = window.APP_TIER === 'pro';

    (function(){
      var isNotion=(location.search.includes('notion=1'))||(window.self!==window.top);
      if(!isNotion)return;
      document.documentElement.classList.add('notion-embed');
      var m=document.querySelector('meta[name="color-scheme"]');
      if(m)m.content=window.matchMedia('(prefers-color-scheme: light)').matches?'light':'dark';
    })();
  </script>
  <style>
    :root {
      /* [ìˆ˜ì • 1] ì „ì²´ ë°°ê²½ íˆ¬ëª…í™” */
      background-color: transparent !important;
      
      /* === í”„ë ˆì„ ì„¤ì • === */
      --frame-w: 673px;
      --frame-h: 673px;

      /* === ìƒë‹¨ í™”ë©´ ìœ„ì¹˜ ì•ˆì •í™” === */
      --screen-top-x: 142px;
      --screen-top-y: 90px;  /* ìœ„ìª½ ì—¬ë°± ìµœì†Œí™” */
      --screen-top-w: 390px;
      --screen-top-h: 280px; 

      /* === í•˜ë‹¨ íŒ¨ë„ ìœ„ì¹˜ === */
      --panel-x: 142px;
      --panel-y: 408px;
      --panel-w: 390px;
      --panel-h: 135px;

      /* [í…Œë§ˆ] ê²Œì„ë³´ì´ ê·¸ë¦° */
      --color-bg: #9bbc0f;      
      --color-ui-bg: #8bac0f;   
      --color-text: #0f380f;    
      --exp-bar-bg: #306230;    
      --exp-bar-fill: #0f380f;  

      /* === ë²„íŠ¼ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€(throw up / throw up 2) ìœ„ì¹˜Â·í¬ê¸° ì¡°ì • === */
      --btn-test-left: 58%;
      --btn-test-top: 60%;
      --btn-test-width: 160px;
      --btn-test-height: 160px;
      /* === stop drink.png ì „ìš© ìœ„ì¹˜Â·í¬ê¸° (ê¸°ë³¸ 58% / 58% / 80px / 80px) === */
      --btn-test-stopdrink-left: 60%;
      --btn-test-stopdrink-top: 55%;
      --btn-test-stopdrink-width: 90px;
      --btn-test-stopdrink-height: 90px;
      /* === throw up 2.png ì „ìš© ìœ„ì¹˜Â·í¬ê¸° === */
      --btn-test-throwup2-left: 58%;
      --btn-test-throwup2-top: 58%;
      --btn-test-throwup2-width: 100px;
      --btn-test-throwup2-height: 100px;
      /* === full_and_sleep.png ì „ìš© ìœ„ì¹˜Â·í¬ê¸° (ë°¥ ë¨¹ê³  ì ë“¤ê¸°) === */
      --full-and-sleep-left: 85%;
      --full-and-sleep-top: 65%;
      --full-and-sleep-width: 115px;
      --full-and-sleep-height: 115px;

      /* === ë¡œê³  ìœ„ì¹˜ === */
      /* main_logo: ê²Œì„ê¸° ìƒë‹¨(ê²€ì€ ë§‰ëŒ€) ì¤‘ì•™ | logo2: í”„ë ˆì„ í™”ë©´ ì•ˆ ì˜¤ë¥¸ìª½ ìƒë‹¨ */
      --logo-top: 8%;
      --logo-left: 68%;
      --logo-max-width: 155px;
      --logo-max-height: 155px;
      --main-logo-top: 1.5%;
      --main-logo-left: 50%;
      --main-logo-max-width: 130px;
      --main-logo-max-height: 130px;

      /* === A, B, C ë²„íŠ¼ ìœ„ì¹˜ === */
      --btn-size: 65px;
      --btn-bottom: 61px;
      --btn-b-bottom: 39px;
      --btn-a-left: 186px;
      --btn-b-left: 303px;
      --btn-c-left: 420px;

      /* === ë¬¼ë°©ìš¸ ìœ„ì¹˜ ì¡°ì • === */
      /* 
       * í˜„ì¬ ë¬¼ë°©ìš¸ ë–¨ì–´ì§€ëŠ” ìµœì  ìœ„ì¹˜ (ë¬¼ ê¸‰ìˆ˜í†µì— ì–´ìš¸ë¦¬ëŠ” ìœ„ì¹˜)
       * ì´ ê°’ë“¤ì€ ë¬¼ ê¸‰ìˆ˜í†µ í´ë¦­ ì˜ì—­ì˜ ì¤‘ì•™ í•˜ë‹¨ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
       * ë¬¼ ê¸‰ìˆ˜í†µ ìœ„ì¹˜ê°€ ë³€ê²½ë˜ë©´ ì´ ê°’ë„ ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
       */
      --water-drop-offset-x: -18px; /* ë¬¼ë°©ìš¸ X ìœ„ì¹˜ ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) - ì¡°ì • í•„ìš” */
      --water-drop-offset-y: -12px; /* ë¬¼ë°©ìš¸ Y ìœ„ì¹˜ ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) - ì¡°ì • í•„ìš” */

      /* === ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ìœ„ì¹˜ ì¡°ì • === */
      /* 
       * ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ì´ í‘œì‹œë  ê³ ì • ìœ„ì¹˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
       * ê¸°ë³¸ê°’ì€ í–„ìŠ¤í„° ì´ë¯¸ì§€ì™€ ë™ì¼í•œ ìœ„ì¹˜(68%, 50%)ì…ë‹ˆë‹¤.
       * ìœ„ì¹˜ë¥¼ ë³€ê²½í•˜ë ¤ë©´ ì•„ë˜ ê°’ë“¤ì„ ì¡°ì •í•˜ì„¸ìš”.
       */
      --grooming-top: 68%; /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ìƒë‹¨ ìœ„ì¹˜ (% ë˜ëŠ” px) - ì¡°ì • ê°€ëŠ¥ */
      --grooming-left: 50%; /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ì¢Œì¸¡ ìœ„ì¹˜ (% ë˜ëŠ” px) - ì¡°ì • ê°€ëŠ¥ */
      --grooming-offset-x: 0px; /* ê·¸ë£¨ë° X ìœ„ì¹˜ ë¯¸ì„¸ ì¡°ì • (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) - ì¡°ì • ê°€ëŠ¥ */
      --grooming-offset-y: -30px; /* ê·¸ë£¨ë° Y ìœ„ì¹˜ ë¯¸ì„¸ ì¡°ì • (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) - ì¡°ì • ê°€ëŠ¥ */
      
      /* === ê° í”„ë ˆì„(í–‰)ë³„ Y ìœ„ì¹˜ ê°œë³„ ì¡°ì • === */
      /* 
       * ìŠ¤í”„ë¼ì´íŠ¸ ì‹œíŠ¸ êµ¬ì¡° (4x4 ê·¸ë¦¬ë“œ, ì´ 16í”„ë ˆì„):
       * 
       * [ë§¨ ìœ„ ì¤„ - í–‰ 0]  í”„ë ˆì„ 0  |  í”„ë ˆì„ 1  |  í”„ë ˆì„ 2  |  í”„ë ˆì„ 3
       * [ë‘ ë²ˆì§¸ ì¤„ - í–‰ 1]  í”„ë ˆì„ 4  |  í”„ë ˆì„ 5  |  í”„ë ˆì„ 6  |  í”„ë ˆì„ 7
       * [ì„¸ ë²ˆì§¸ ì¤„ - í–‰ 2]  í”„ë ˆì„ 8  |  í”„ë ˆì„ 9  |  í”„ë ˆì„ 10 |  í”„ë ˆì„ 11
       * [ë„¤ ë²ˆì§¸ ì¤„ - í–‰ 3]  í”„ë ˆì„ 12 |  í”„ë ˆì„ 13 |  í”„ë ˆì„ 14 |  í”„ë ˆì„ 15
       * 
       * ê° í–‰ë§ˆë‹¤ ìœ„ì¹˜ê°€ ë‹¤ë¥¼ ê²½ìš° ê°œë³„ì ìœ¼ë¡œ ì¡°ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.
       * ì• ë‹ˆë©”ì´ì…˜ì„ ì¬ìƒí•˜ë©´ì„œ ì–´ë–¤ ì¤„ì´ ìœ„/ì•„ë˜ë¡œ ì›€ì§ì´ëŠ”ì§€ í™•ì¸í•˜ê³  ì¡°ì •í•˜ì„¸ìš”.
       */
      --grooming-row-0-y-offset: -16px; /* ë§¨ ìœ„ ì¤„ (í–‰ 0, í”„ë ˆì„ 0-3) Y ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) */
      --grooming-row-1-y-offset: 9px; /* ë‘ ë²ˆì§¸ ì¤„ (í–‰ 1, í”„ë ˆì„ 4-7) Y ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) */
      --grooming-row-2-y-offset: -2px; /* ì„¸ ë²ˆì§¸ ì¤„ (í–‰ 2, í”„ë ˆì„ 8-11) Y ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) */
      --grooming-row-3-y-offset: 8px; /* ë„¤ ë²ˆì§¸ ì¤„ (í–‰ 3, í”„ë ˆì„ 12-15) Y ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) */
      
      /* ê° í–‰ë³„ X ì˜¤í”„ì…‹ (ì™¼ìª½/ì˜¤ë¥¸ìª½ ì¡°ì •) */
      --grooming-row-0-x-offset: 0px; /* ë§¨ ìœ„ ì¤„ (í–‰ 0, í”„ë ˆì„ 0-3) X ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) */
      --grooming-row-1-x-offset: 0px; /* ë‘ ë²ˆì§¸ ì¤„ (í–‰ 1, í”„ë ˆì„ 4-7) X ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) */
      --grooming-row-2-x-offset: 0px; /* ì„¸ ë²ˆì§¸ ì¤„ (í–‰ 2, í”„ë ˆì„ 8-11) X ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) */
      --grooming-row-3-x-offset: 0px; /* ë„¤ ë²ˆì§¸ ì¤„ (í–‰ 3, í”„ë ˆì„ 12-15) X ì˜¤í”„ì…‹ (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) */
      
      /* === ìœ„ìª½ ì´ë¯¸ì§€ ì˜ë¼ë‚´ê¸° ì¡°ì • === */
      /* ê° í–‰ì˜ ì˜¤í”„ì…‹ì„ ì¡°ì •í•œ í›„ ìœ„ìª½ì—ì„œ ë‹¤ë¥¸ í–„ìŠ¤í„° ì´ë¯¸ì§€ê°€ ë³´ì´ë©´ ì´ ê°’ì„ ì¦ê°€ì‹œí‚¤ì„¸ìš” */
      --grooming-clip-top: 28px; /* ìœ„ìª½ì—ì„œ ì˜ë¼ë‚¼ í”½ì…€ ìˆ˜ (ê°’ì´ í´ìˆ˜ë¡ ë” ë§ì´ ì˜ë¦¼) - ì¡°ì • ê°€ëŠ¥ */
      
      /* === ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ì†ë„ ì¡°ì • === */
      /* í”„ë ˆì„ë‹¹ ë°€ë¦¬ì´ˆ (ê°’ì´ í´ìˆ˜ë¡ ëŠë¦¼, ì‘ì„ìˆ˜ë¡ ë¹ ë¦„) */
      /* ê¶Œì¥ê°’: 100-150ms (ìì—°ìŠ¤ëŸ¬ìš´ ì†ë„), 80ms (ë¹ ë¥¸ ì†ë„), 200ms (ëŠë¦° ì†ë„) */
      --grooming-animation-speed: 42ms; /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ê¸°ë³¸ ì†ë„ - ì¡°ì • ê°€ëŠ¥ */
      
      /* === ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ìì—°ìŠ¤ëŸ¬ì›€ ì¡°ì • === */
      /* í”„ë ˆì„ í™€ë“œ: íŠ¹ì • í”„ë ˆì„ì„ ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•˜ì—¬ ë” ì˜¤ë˜ ë³´ì—¬ì£¼ê¸° (ìì—°ìŠ¤ëŸ¬ìš´ ëŠë‚Œ) */
      /* ê°’ì´ í´ìˆ˜ë¡ í•´ë‹¹ í”„ë ˆì„ì„ ë” ì˜¤ë˜ ë³´ì—¬ì¤Œ (ì˜ˆ: 2 = 2ë°° ì˜¤ë˜, 3 = 3ë°° ì˜¤ë˜) */
      --grooming-frame-hold: 3; /* í”„ë ˆì„ í™€ë“œ ë°°ìˆ˜ (1 = ê¸°ë³¸, 2 = 2ë°°, 3 = 3ë°°) - ì¡°ì • ê°€ëŠ¥ */
      
      /* === ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ë°˜ë³µ íšŸìˆ˜ === */
      /* ì „ì²´ ì• ë‹ˆë©”ì´ì…˜ì„ ëª‡ ë²ˆ ë°˜ë³µí• ì§€ ì„¤ì • (1 = 1ë²ˆë§Œ ì¬ìƒ, 2 = 2ë²ˆ ë°˜ë³µ, 3 = 3ë²ˆ ë°˜ë³µ) */
      --grooming-repeat-count: 2; /* ì• ë‹ˆë©”ì´ì…˜ ë°˜ë³µ íšŸìˆ˜ (1 = ê¸°ë³¸, 2 = 2ë°° ì‹œê°„, 3 = 3ë°° ì‹œê°„) - ì¡°ì • ê°€ëŠ¥ */
      
      /* í”„ë ˆì„ë³„ ê°€ë³€ ì†ë„: íŠ¹ì • í”„ë ˆì„ì—ë§Œ ë‹¤ë¥¸ ì†ë„ ì ìš© (0 = ê¸°ë³¸ ì†ë„ ì‚¬ìš©, ì–‘ìˆ˜ = í•´ë‹¹ í”„ë ˆì„ë§Œ ì´ ì†ë„ë¡œ) */
      /* ì˜ˆ: --grooming-frame-0-speed: 150ms; (í”„ë ˆì„ 0ë§Œ 150msë¡œ ì¬ìƒ) */
      /* ê° í”„ë ˆì„(0-15)ë³„ë¡œ ê°œë³„ ì†ë„ ì„¤ì • ê°€ëŠ¥ (ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ì†ë„ ì‚¬ìš©) */
      --grooming-frame-0-speed: 42ms;    /* ì‹œì‘ í”„ë ˆì„ì„ ì¡°ê¸ˆ ëŠë¦¬ê²Œ */
      --grooming-frame-8-speed: 42ms;    /* ì¤‘ê°„ í”„ë ˆì„ ì†ë„ */
      --grooming-frame-15-speed: 42ms;   /* ë í”„ë ˆì„ì„ ì¡°ê¸ˆ ëŠë¦¬ê²Œ */

      /* === back.png (í™”ë‚œ/ì‚ì§„ ëª¨ìŠµ) ìœ„ì¹˜Â·í¬ê¸° ì¡°ì • === */
      --back-left: 54%;           /* ê¸°ë³¸ ìœ„ì¹˜ (% ë˜ëŠ” px) - ì¡°ì • ê°€ëŠ¥ */
      --back-top: 68%;            /* ê¸°ë³¸ ìœ„ì¹˜ (% ë˜ëŠ” px) - ì¡°ì • ê°€ëŠ¥ */
      --back-width: 245px;        /* back.png í¬ê¸° - ì¡°ì • ê°€ëŠ¥ */
      --back-height: 245px;       /* back.png í¬ê¸° - ì¡°ì • ê°€ëŠ¥ */
      --back-offset-x: 0px;       /* X ë¯¸ì„¸ ì¡°ì • (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) */
      --back-offset-y: 0px;       /* Y ë¯¸ì„¸ ì¡°ì • (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) */

      /* === í™”ë‚œ ë§í’ì„  ìœ„ì¹˜ ì¡°ì • === */
      --angry-bubble-right: 62px; /* ì˜¤ë¥¸ìª½ì—ì„œì˜ ê±°ë¦¬ (ê°’ì´ í´ìˆ˜ë¡ ì™¼ìª½ìœ¼ë¡œ) */
      --angry-bubble-top: 56%;    /* ì„¸ë¡œ ìœ„ì¹˜ (% ë˜ëŠ” px) */
      --angry-bubble-offset-x: 0px; /* X ë¯¸ì„¸ ì¡°ì • (ì–‘ìˆ˜=ì˜¤ë¥¸ìª½, ìŒìˆ˜=ì™¼ìª½) */
      --angry-bubble-offset-y: 0px; /* Y ë¯¸ì„¸ ì¡°ì • (ì–‘ìˆ˜=ì•„ë˜, ìŒìˆ˜=ìœ„) */

      /* === ê²Œì„ ìŠ¤íƒ€íŠ¸ ë²„íŠ¼ ìœ„ì¹˜/í¬ê¸° ì¡°ì ˆ === */
      --start-btn-top: 91.3%;
      --start-btn-left: 50%;
      --start-btn-width: 555px;
      --start-btn-height: 175px;
    }

    * { box-sizing: border-box; }
    
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      min-height: 100vh;
      overflow: hidden;
      /* [ìˆ˜ì • 2] body ë°°ê²½ íˆ¬ëª…í™” */
      background-color: transparent !important;
      font-family: 'Press Start 2P', 'Noto Sans KR', sans-serif;
    }

    /* ë…¸ì…˜ ì„ë² ë“œ: ê¸°ë³¸=íˆ¬ëª…(ê²Œì„ê¸°ë§Œ ë³´ì´ê²Œ), ë‹¤í¬ì¼ ë•Œë§Œ ì–´ë‘ìš´ ë°°ê²½ */
    html.notion-embed { color-scheme: light; }
    html.notion-embed,
    html.notion-embed body,
    html.notion-embed .device-wrapper,
    html.notion-embed .scale-wrapper,
    html.notion-embed .device-container {
      background: transparent !important;
      background-color: transparent !important;
    }
    /* ë¼ì´íŠ¸ ëª¨ë“œ: íŒ¨ë„ ì—¬ë°±ì„ ê²€ì€ìƒ‰ìœ¼ë¡œ ìœ ì§€ (í° ë°°ê²½ì— íˆ¬ëª… ì‹œ ì—¬ë°±ì´ í‹°ë‚¨ ë°©ì§€) */
    html.notion-embed .panel-gap-top,
    html.notion-embed .panel-gap {
      background: #000 !important;
      background-color: #000 !important;
    }
    html.notion-embed .start-screen {
      background: transparent !important;
      background-color: transparent !important;
    }
    /* ë…¸ì…˜ ì„ë² ë“œ: ì¸ë„¤ì¼ ì´ë¯¸ì§€ ë¡œë“œ ì•ˆ í•¨ (ë°”ë¡œ ê²Œì„ í™”ë©´ìœ¼ë¡œ ì§„ì…) */
    html.notion-embed .start-screen-bg {
      background-image: none !important;
      background: transparent !important;
    }
    @media (prefers-color-scheme: dark) {
      html.notion-embed { color-scheme: dark; }
      html.notion-embed, html.notion-embed body, html.notion-embed .device-wrapper {
        background: #191919 !important;
        background-color: #191919 !important;
      }
      html.notion-embed .panel-gap-top, html.notion-embed .panel-gap {
        background: #191919 !important;
        background-color: #191919 !important;
      }
    }

    /* ë…¸ì…˜ ì„ë² ë“œ: í†µê³„ íŒ¨ë„ ë” ë§ì´ ë³´ì´ë„ë¡ */
    html.notion-embed .stats-panel {
      max-height: 90vh;
    }
    html.notion-embed .stats-section {
      margin-bottom: 14px;
    }

    /* ë°˜ì‘í˜• ë˜í¼ */
    .device-wrapper {
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0;
      overflow: hidden;
      /* [ìˆ˜ì • 3] ë˜í¼ ë°°ê²½ íˆ¬ëª…í™” */
      background-color: transparent !important;
    }

    .scale-wrapper {
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
      background: transparent !important;
    }

    .device-container {
      position: relative;
      width: var(--frame-w);
      height: var(--frame-h);
      transform-origin: top left;
      flex-shrink: 0;
    }

    /* === ë ˆì´ì–´ 1: ìƒë‹¨ í™”ë©´ === */
    .screen-top {
      position: absolute;
      left: var(--screen-top-x);
      top: var(--screen-top-y);
      width: var(--screen-top-w);
      height: var(--screen-top-h);
      background-color: var(--color-bg);
      z-index: 10;
      overflow: hidden; 
      border-radius: 25px 25px 10px 10px; 
    }

    .bg-image {
      width: 100%;
      height: 100%; 
      object-fit: cover;
      object-position: 30% bottom; /* ì™¼ìª½ ì³‡ë°”í€´ê°€ ë³´ì´ë„ë¡ */
      image-rendering: pixelated;
      display: block;
    }

    /* ì§‘ í´ë¦­ ì˜ì—­ */
    .house-click-area {
      position: absolute;
      right: 10px;
      top: 90px;
      width: 57px;
      height: 110px;
      z-index: 15;
      cursor: pointer;
      background: transparent;
    }

    /* ê·¸ë¦‡ í´ë¦­ ì˜ì—­ */
    .bowl-click-area {
      position: absolute;
      right: 75px;
      bottom: 90px;
      width: 60px;
      height: 49px;
      z-index: 25; /* í•˜ë£¨ì¹˜(z-index: 20)ë³´ë‹¤ ë†’ê²Œ ì„¤ì • */
      cursor: pointer;
      background: transparent;
    }

    /* ë¬¼ ê¸‰ìˆ˜í†µ í´ë¦­ ì˜ì—­ */
    /* 
     * ìœ„ì¹˜ ì¡°ì • ë°©ë²•:
     * - right: ì˜¤ë¥¸ìª½ì—ì„œì˜ ê±°ë¦¬ (ê°’ì´ í´ìˆ˜ë¡ ì™¼ìª½ìœ¼ë¡œ ì´ë™)
     * - bottom: ì•„ë˜ì—ì„œì˜ ê±°ë¦¬ (ê°’ì´ í´ìˆ˜ë¡ ìœ„ë¡œ ì´ë™)
     * - width/height: í´ë¦­ ì˜ì—­ í¬ê¸°
     * 
     * bg.pngì˜ ë¬¼ ê¸‰ìˆ˜í†µ ìœ„ì¹˜ì— ë§ì¶° ì¡°ì •í•˜ì„¸ìš”.
     * í˜„ì¬: right: 15px (ì˜¤ë¥¸ìª½ ë), bottom: 90px (ì•„ë˜ì—ì„œ 90px ìœ„)
     */
    .water-bottle-click-area {
      position: absolute;
      right: 196px; /* ì˜¤ë¥¸ìª½ì— ë°°ì¹˜ (ê·¸ë¦‡ê³¼ ì§‘ ì‚¬ì´) - ë¬¼ ê¸‰ìˆ˜í†µ ìœ„ì¹˜ì— ë§ì¶° ì¡°ì • */
      bottom: 146px; /* ì•„ë˜ì—ì„œ 90px ìœ„ - ë¬¼ ê¸‰ìˆ˜í†µ ë†’ì´ì— ë§ì¶° ì¡°ì • */
      width: 42px; /* ë¬¼ ê¸‰ìˆ˜í†µ í¬ê¸°ì— ë§ì¶° ì¡°ì • */
      height: 118px; /* ë¬¼ ê¸‰ìˆ˜í†µ ë†’ì´ì— ë§ì¶° ì¡°ì • */
      z-index: 25; /* í•˜ë£¨ì¹˜(z-index: 20)ë³´ë‹¤ ë†’ê²Œ ì„¤ì • */
      cursor: pointer;
      background: transparent;
    }

    /* ë¬¼ 10íšŒ ì´ìƒ ì‹œ ë¬¼ ê¸‰ìˆ˜í†µ ìª½ í† í•˜ëŠ” ëª¨ì…˜ (throw up 2) ì˜¤ë²„ë ˆì´ */
    .throwup2-overlay {
      position: absolute;
      right: 170px;
      bottom: 140px;
      width: 90px;
      height: 90px;
      z-index: 26;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .throwup2-overlay img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      image-rendering: pixelated;
    }

    /* í•˜ë£¨ì¹˜ ìœ„ì¹˜ ì¡°ì • */
    .hamster {
      position: absolute;
      width: 290px; /* ì›ë˜ í¬ê¸° ìœ ì§€ */
      height: 290px; /* ì›ë˜ í¬ê¸° ìœ ì§€ */
      left: 50%; 
      top: 68%; 
      transform: translate(-50%, -50%);
      image-rendering: pixelated;
      z-index: 20;
      pointer-events: none; /* ì´ë¯¸ì§€ ìì²´ëŠ” í´ë¦­ ë¶ˆê°€ */
      background-size: 400% 400%; /* 4x4 ê·¸ë¦¬ë“œ (16í”„ë ˆì„) */
      background-repeat: no-repeat;
      background-position: 0% 0%;
    }
    /* A ë²„íŠ¼ throw up.png ì „ìš© ìœ„ì¹˜Â·í¬ê¸° (ì¡°ì • íŒ¨ë„ì—ì„œ ë³€ê²½) */
    .hamster.btn-test-adjust {
      left: var(--btn-test-left) !important;
      top: var(--btn-test-top) !important;
      width: var(--btn-test-width) !important;
      height: var(--btn-test-height) !important;
    }
    /* C ë²„íŠ¼ throw up 2.png ì „ìš© ìœ„ì¹˜Â·í¬ê¸° */
    .hamster.btn-test-throwup2 {
      left: var(--btn-test-throwup2-left) !important;
      top: var(--btn-test-throwup2-top) !important;
      width: var(--btn-test-throwup2-width) !important;
      height: var(--btn-test-throwup2-height) !important;
    }
    /* B ë²„íŠ¼ stop drink.png ì „ìš© ìœ„ì¹˜Â·í¬ê¸° (58%/58%, 80px/80px ê¸°ë³¸) */
    .hamster.btn-test-stopdrink {
      left: var(--btn-test-stopdrink-left) !important;
      top: var(--btn-test-stopdrink-top) !important;
      width: var(--btn-test-stopdrink-width) !important;
      height: var(--btn-test-stopdrink-height) !important;
    }

    /* back.png (í™”ë‚œ/ì‚ì§„ ëª¨ìŠµ) ì „ìš© ìœ„ì¹˜Â·í¬ê¸° */
    .hamster.angry {
      left: calc(var(--back-left) + var(--back-offset-x)) !important;
      top: calc(var(--back-top) + var(--back-offset-y)) !important;
      width: var(--back-width) !important;
      height: var(--back-height) !important;
      transform: translate(-50%, -50%) !important;
    }

    /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ */
    .hamster.grooming {
      /* img íƒœê·¸ì˜ src ì´ë¯¸ì§€ë¥¼ ì™„ì „íˆ ìˆ¨ê¹€ */
      opacity: 0 !important; /* normal ì´ë¯¸ì§€ ìˆ¨ê¹€ */
      visibility: hidden !important; /* ì™„ì „íˆ ìˆ¨ê¹€ */
      /* í”„ë ˆì„ í¬ê¸°ëŠ” ì›ë˜ëŒ€ë¡œ ìœ ì§€ (290px) */
      /* ìœ„ì¹˜ ê³ ì • - bounce ì• ë‹ˆë©”ì´ì…˜ ì œê±°ë¡œ ì¸í•œ ìœ„ì¹˜ ë³€ê²½ ë°©ì§€ */
      transform: translate(-50%, -50%) !important;
    }
    
    /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ìš© ì˜¤ë²„ë ˆì´ div */
    .grooming-overlay {
      position: absolute;
      top: calc(var(--grooming-top) + var(--grooming-offset-y)); /* CSS ë³€ìˆ˜ë¡œ ìœ„ì¹˜ ì¡°ì • ê°€ëŠ¥ */
      left: calc(var(--grooming-left) + var(--grooming-offset-x)); /* CSS ë³€ìˆ˜ë¡œ ìœ„ì¹˜ ì¡°ì • ê°€ëŠ¥ */
      transform: translate(-50%, -50%) !important; /* ì¤‘ì•™ ì •ë ¬, ìœ„ì¹˜ ê³ ì • */
      width: 120px; /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ í¬ê¸° (ë…¸ë©€ ì´ë¯¸ì§€ì™€ ë™ì¼í•œ í¬ê¸°) */
      height: 120px; /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ í¬ê¸° (ë…¸ë©€ ì´ë¯¸ì§€ì™€ ë™ì¼í•œ í¬ê¸°) */
      background-image: url('./assets/animations/spr_hamster_shedding.png');
      /* background-sizeëŠ” JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì •ë¨ */
      background-repeat: no-repeat;
      background-position: 0px 0px; /* JavaScriptë¡œ ì—…ë°ì´íŠ¸ë¨ */
      image-rendering: pixelated;
      pointer-events: none;
      z-index: 21; /* í–„ìŠ¤í„° ìœ„ì— í‘œì‹œ */
      display: none;
      overflow: hidden; /* ì˜ì—­ ë°–ì˜ ì´ë¯¸ì§€ ìˆ¨ê¹€ */
      /* ìœ„ìª½ ë¶€ë¶„ì„ ì˜ë¼ë‚´ê¸° ìœ„í•œ clip-path (CSS ë³€ìˆ˜ë¡œ ì¡°ì • ê°€ëŠ¥) */
      clip-path: inset(var(--grooming-clip-top) 0 0 0); /* ìœ„ìª½ì—ì„œ ì˜ë¼ë‚´ê¸° (ì¡°ì • ê°€ëŠ¥) */
    }
    
    .grooming-overlay.active {
      display: block;
    }

    /* í•˜ë£¨ì¹˜ ì“°ë‹¤ë“¬ê¸° í´ë¦­ ì˜ì—­ */
    .hamster-click-area {
      position: absolute;
      width: 70px; /* í´ë¦­ ì˜ì—­ í¬ê¸° (ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì •) */
      height: 86px; /* í´ë¦­ ì˜ì—­ í¬ê¸° (ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì •) */
      left: 50%;
      top: 67%;
      transform: translate(-50%, -50%);
      z-index: 21; /* í–„ìŠ¤í„° ì´ë¯¸ì§€ ìœ„ì— */
      cursor: pointer;
      background: transparent;
    }

    /* === ìƒë‹¨ íŒ¨ë„ ìœ„ ì‚´ì§ ì—¬ë°± (ê²€ì€ìƒ‰ ìœ ì§€ - ê¸°ê¸° ë‚´ë¶€ ë””ìì¸) === */
    .panel-gap-top {
      position: absolute;
      left: var(--panel-x);
      top: var(--screen-top-y);
      width: var(--panel-w);
      height: 14px;
      background-color: #000;
      z-index: 10;
      border-radius: 25px 25px 0 0;
    }

    /* === ìƒë‹¨Â·í•˜ë‹¨ íŒ¨ë„ ì‚¬ì´ ì—¬ë°± (ê²€ì€ìƒ‰ ìœ ì§€ - ê¸°ê¸° ë‚´ë¶€ ë””ìì¸) === */
    .panel-gap {
      position: absolute;
      left: var(--panel-x);
      top: calc(var(--screen-top-y) + var(--screen-top-h));
      width: var(--panel-w);
      height: calc(var(--panel-y) - var(--screen-top-y) - var(--screen-top-h));
      background-color: #000;
      z-index: 10;
    }

    /* === ë ˆì´ì–´ 2: í•˜ë‹¨ íŒ¨ë„ === */
    .screen-bottom {
      position: absolute;
      left: var(--panel-x);
      top: var(--panel-y);
      width: var(--panel-w);
      height: var(--panel-h);
      background-color: var(--color-ui-bg);
      z-index: 10;
      border-radius: 5px 5px 30px 30px; 
      padding: 0; 
      display: flex;
      gap: 0; 
      color: var(--color-text);
      align-items: stretch;
    }

    /* === ë ˆì´ì–´ 3: í”„ë ˆì„ === */
    .layer-frame {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 100; 
      pointer-events: none; 
    }
    .layer-frame img.frame-img { width: 100%; display: block; }
    /* logo2.png: í”„ë ˆì„ í™”ë©´ ì•ˆ ì˜¤ë¥¸ìª½ ìƒë‹¨ (HARUCHI) */
    .device-logo {
      position: absolute;
      top: var(--logo-top);
      left: var(--logo-left);
      transform: translateX(-50%);
      width: var(--logo-width, auto);
      max-width: var(--logo-max-width);
      max-height: var(--logo-max-height);
      object-fit: contain;
      z-index: 101;
      image-rendering: pixelated;
    }
    /* main_logo: ê²Œì„ê¸° ìƒë‹¨(ê²€ì€ ë§‰ëŒ€) ì¤‘ì•™ (YH) */
    .main-logo {
      position: absolute;
      top: var(--main-logo-top);
      left: var(--main-logo-left);
      transform: translateX(-50%);
      width: var(--main-logo-width, auto);
      max-width: var(--main-logo-max-width);
      max-height: var(--main-logo-max-height);
      object-fit: contain;
      z-index: 102;
      image-rendering: pixelated;
    }

    /* ì™¼ìª½ íŒ¨ë„ (LV/EXP) */
    .panel-left {
      flex: 1;
      width: 50%; 
      display: flex;
      flex-direction: column;
      justify-content: center; 
      align-items: center; 
      padding-top: 0;
      padding-bottom: 15px;
      border-right: 2px dashed rgba(15, 56, 15, 0.5); 
    }

    .stat-row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      width: 100px; 
      margin-bottom: 1px;
    }

    .stat-row span:first-child {
      font-size: 14px;
      font-weight: bold;
      color: #0f380f; 
    }

    #expText {
      font-size: 10px; 
      color: #306230;
      font-weight: normal;
    } 

    .val-level { 
      font-size: 16px; 
      color: #ffffff; 
      text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
    }

    .exp-track {
      width: 120px;
      height: 12px;
      background: var(--exp-bar-bg);
      border: 2px solid var(--color-text);
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }
    .exp-fill {
      height: 100%;
      width: 0%;
      background-color: var(--exp-bar-fill);
      transition: width 0.3s;
    }

    /* ì¼ì¼ ëª©í‘œ ì§„í–‰ë¥  */
    .goal-row {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 8px;
      color: var(--color-text);
      line-height: 1.1;
    }

    .goal-label {
      font-weight: bold;
      font-size: 10px;
      transform: translate(-3px, -1px);
    }

    .goal-progress {
      color: #ffffff;
      font-weight: bold;
      font-size: 8px;
    }

    .goal-percent {
      color: #ffffff;
      font-size: 8px;
      margin-left: 4px;
      font-weight: bold;
    }

    /* ë ˆë²¨ë³„ ì¹­í˜¸ */
    .title-row {
      margin-top: 4px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .hamster-title {
      font-size: 12px;
      color: #ffffff;
      font-weight: bold;
      text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 7px 10px;
      background: rgba(15, 56, 15, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 6px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.3), 0 2px 4px rgba(0,0,0,0.2);
      letter-spacing: 0.5px;
      line-height: 1.4;
      width: calc(100% - 16px);
      text-align: center;
      white-space: nowrap;
    }

    /* EXP íŒŒí‹°í´ íš¨ê³¼ */
    .exp-particle {
      position: absolute;
      color: #8bac0f;
      font-size: 22px;
      font-weight: bold;
      pointer-events: none;
      z-index: 300;
      text-shadow: 2px 2px 0px rgba(0,0,0,0.8), 0 0 8px rgba(139,172,15,0.6);
      animation: expFloat 1.5s ease-out forwards;
    }

    @keyframes expFloat {
      0% {
        opacity: 1;
        transform: translateY(0) translateX(0) scale(0.8);
      }
      25% {
        transform: translateY(-20px) translateX(-3px) scale(1.0);
      }
      50% {
        opacity: 1;
        transform: translateY(-40px) translateX(3px) scale(1.2);
      }
      75% {
        transform: translateY(-60px) translateX(-2px) scale(1.0);
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) translateX(0) scale(0.8);
      }
    }

    /* ì˜¤ë¥¸ìª½ íŒ¨ë„ (ë¡œê·¸) */
    .panel-right {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      padding-top: 10px; 
      padding-left: 20px; 
      overflow: hidden;
    }

    .log-title {
      font-size: 8px;
      margin-top: 5px;
      margin-bottom: 10px;
      opacity: 1;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #0f380f;
    }

    .log-content {
      width: 100%;
      flex: 1;
      font-family: 'Noto Sans KR', sans-serif;
      overflow-y: auto;
      font-size: 11px;
      line-height: 1.5;
      padding-bottom: 5px; 
      scrollbar-width: none; 
      display: flex;
      flex-direction: column;
      justify-content: flex-start; 
      gap: 2px; 
      padding-top: 0; 
    }
    .log-content::-webkit-scrollbar { display: none; }

    .log-panel-clickable { cursor: pointer; }
    
    .log-modal-panel { max-width: 90%; width: 400px; max-height: 70vh; }
    .log-modal-content {
      overflow-y: auto;
      max-height: calc(70vh - 60px);
      font-family: 'Noto Sans KR', sans-serif;
      font-size: 12px;
      line-height: 1.6;
    }
    .log-modal-content .log-line { margin-bottom: 4px; }
    .log-section { margin-bottom: 14px; }
    .log-section-title {
      font-size: 10px;
      font-weight: bold;
      color: var(--color-text);
      margin-bottom: 6px;
      padding-bottom: 4px;
      border-bottom: 2px solid var(--exp-bar-bg);
    }
    .log-date {
      font-size: 8px;
      color: rgba(255,255,255,0.6);
      margin-right: 6px;
    }
    .log-refresh-wrap { margin-bottom: 10px; text-align: right; }
    .log-refresh-btn {
      padding: 4px 10px;
      font-size: 10px;
      background: var(--color-text);
      color: var(--color-ui-bg);
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .log-cat-tag {
      display: inline-block;
      font-size: 8px;
      padding: 1px 5px;
      margin-right: 6px;
      border-radius: 4px;
      background: var(--exp-bar-bg);
      color: #fff;
    }
    .log-xp { color: var(--exp-bar-fill); font-weight: bold; }
    .log-item { margin-bottom: 3px; }


    .log-item.new { color: #0f380f; font-weight: bold; animation: flash 0.5s; } /* ì¼ë°˜ ë¡œê·¸ */
    .log-item.level-up { color: #ffcc00; font-weight: bold; animation: flash 0.5s; } /* ë ˆë²¨ ì—… - ë°ì€ ê³¨ë“œ */
    .log-item.important { color: #2d3d1f; font-weight: bold; animation: flash 0.5s; } /* ì¤‘ìš” ë©”ì‹œì§€ */
    @keyframes flash { 0% { opacity: 0; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

    /* í™”ë‚œ ë§í’ì„  (ì˜¤ë¥¸ìª½, ë¹ ì§ í‘œí˜„) - ìœ„ì¹˜ëŠ” CSS ë³€ìˆ˜ë¡œ ì¡°ì • ê°€ëŠ¥ */
    .angry-speech-bubble {
      position: absolute;
      right: calc(var(--angry-bubble-right) + var(--angry-bubble-offset-x));
      top: calc(var(--angry-bubble-top) + var(--angry-bubble-offset-y));
      transform: translateY(-50%);
      background: #fff;
      border: 3px solid #0f380f;
      border-radius: 12px;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: bold;
      color: #0f380f;
      z-index: 22;
      box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
      display: none;
      animation: angryBubblePop 0.3s ease-out;
      white-space: nowrap;
    }
    .angry-speech-bubble::after {
      content: '';
      position: absolute;
      left: -12px;
      top: 50%;
      transform: translateY(-50%);
      border: 8px solid transparent;
      border-right-color: #fff;
      border-left: none;
    }
    .angry-speech-bubble::before {
      content: '';
      position: absolute;
      left: -15px;
      top: 50%;
      transform: translateY(-50%);
      border: 9px solid transparent;
      border-right-color: #0f380f;
      border-left: none;
    }
    .angry-speech-bubble.show {
      display: block;
    }
    @keyframes angryBubblePop {
      0% { transform: translateY(-50%) scale(0.5); opacity: 0; }
      70% { transform: translateY(-50%) scale(1.1); opacity: 1; }
      100% { transform: translateY(-50%) scale(1); opacity: 1; }
    }

    /* ë¬¼ ë§ˆì‹œëŠ” ë§í’ì„  (ì±±ì±±ì±± / í• ì§í• ì§) */
    .drink-speech-bubble {
      position: absolute;
      left: 53%;
      top: 28%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 3px solid #0f380f;
      border-radius: 12px;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: bold;
      color: #0f380f;
      z-index: 22;
      box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
      display: none;
      animation: drinkBubblePop 0.3s ease-out;
      white-space: nowrap;
    }
    .drink-speech-bubble::after {
      content: '';
      position: absolute;
      left: 50%;
      bottom: -12px;
      transform: translateX(-50%);
      border: 8px solid transparent;
      border-top-color: #fff;
      border-bottom: none;
    }
    .drink-speech-bubble::before {
      content: '';
      position: absolute;
      left: 50%;
      bottom: -15px;
      transform: translateX(-50%);
      border: 9px solid transparent;
      border-top-color: #0f380f;
      border-bottom: none;
    }
    .drink-speech-bubble.show {
      display: block;
    }
    @keyframes drinkBubblePop {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      70% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    /* ë’¤íƒœ ë§í’ì„  (ì”°ë£©ì”°ë£© / í† ì‹¤í† ì‹¤) - ì˜¤ë¥¸ìª½ ë°°ì¹˜ */
    .butt-speech-bubble {
      position: absolute;
      right: calc(var(--angry-bubble-right) + var(--angry-bubble-offset-x));
      top: calc(var(--angry-bubble-top) + var(--angry-bubble-offset-y));
      transform: translateY(-50%);
      background: #fff;
      border: 3px solid #0f380f;
      border-radius: 12px;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: bold;
      color: #0f380f;
      z-index: 22;
      box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
      display: none;
      animation: buttBubblePop 0.3s ease-out;
      white-space: nowrap;
    }
    .butt-speech-bubble::after {
      content: '';
      position: absolute;
      left: -12px;
      top: 50%;
      transform: translateY(-50%);
      border: 8px solid transparent;
      border-right-color: #fff;
      border-left: none;
    }
    .butt-speech-bubble::before {
      content: '';
      position: absolute;
      left: -15px;
      top: 50%;
      transform: translateY(-50%);
      border: 9px solid transparent;
      border-right-color: #0f380f;
      border-left: none;
    }
    .butt-speech-bubble.show {
      display: block;
    }
    @keyframes buttBubblePop {
      0% { transform: translateY(-50%) scale(0.5); opacity: 0; }
      70% { transform: translateY(-50%) scale(1.1); opacity: 1; }
      100% { transform: translateY(-50%) scale(1); opacity: 1; }
    }

    /* back.png ë’¤íƒœ ëª¨ë“œ - ì”°ë£©ì”°ë£©ì¼ ë•Œ ì—‰ë©ì´ í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
    .hamster.butt {
      left: calc(var(--back-left) + var(--back-offset-x)) !important;
      top: calc(var(--back-top) + var(--back-offset-y)) !important;
      width: var(--back-width) !important;
      height: var(--back-height) !important;
      transform-origin: center 75%; /* í•˜ë‹¨ ìª½ ê¸°ì¤€ì  (ì—‰ë©ì´ ìª½) */
    }
    .hamster.butt:not(.butt-wiggle) {
      transform: translate(-50%, -50%) !important;
    }
    .hamster.butt.butt-wiggle {
      animation: buttWiggle 0.42s cubic-bezier(0.22, 1.5, 0.45, 1) infinite;
    }
    /* ë¹µë¹µ í”ë“¤í”ë“¤ ì°°ì§„ ë¹µëŒ•ì´ - ë¹ ë¥´ê³  ê²½ì¾Œí•˜ê²Œ */
    @keyframes buttWiggle {
      0%, 100% { transform: translate(-50%, -50%) rotate(0deg) scale(1, 1); }
      20% { transform: translate(-50%, -50%) rotate(7deg) scale(1.06, 0.92); }
      40% { transform: translate(-50%, -50%) rotate(-6deg) scale(0.93, 1.08); }
      60% { transform: translate(-50%, -50%) rotate(5deg) scale(1.05, 0.94); }
      80% { transform: translate(-50%, -50%) rotate(-4deg) scale(0.95, 1.05); }
    }

    /* ë²„íŠ¼ ì˜ì—­ */
    .btn-area {
      position: absolute;
      bottom: var(--btn-bottom);
      width: var(--btn-size);
      height: var(--btn-size);
      z-index: 200;
      cursor: pointer;
      border-radius: 50%;
      background: transparent;
    }
    .btn-a { left: var(--btn-a-left); }
    .btn-b { left: var(--btn-b-left); bottom: var(--btn-b-bottom); }
    .btn-c { left: var(--btn-c-left); }

    .bounce { animation: bounce 2s infinite ease-in-out; }
    @keyframes bounce { 
      0%, 100% { transform: translate(-50%, -50%) translateY(0); } 
      50% { transform: translate(-50%, -50%) translateY(-6px); } 
    }

    /* ì ìëŠ” ëª¨ìŠµ (ì˜¤ë¥¸ìª½ ì§‘ ì•ˆ) */
    .hamster.sleeping {
      left: 89% !important; /* ì‚´ì§ ì˜¤ë¥¸ìª½ìœ¼ë¡œ */
      top: 65% !important; /* ì‚´ì§ ìœ„ë¡œ */
      width: 120px !important; /* í¬ê¸° ì‚´ì§ ì¤„ì´ê¸° */
      height: 120px !important;
      transform: translate(-50%, -50%);
      animation: sleepBreath 2s infinite ease-in-out;
    }
    /* full_and_sleep ì „ìš© ìœ„ì¹˜Â·í¬ê¸° (ì¡°ì • íŒ¨ë„ì—ì„œ ë³€ê²½) */
    .hamster.sleeping.full-and-sleep-adjust {
      left: var(--full-and-sleep-left) !important;
      top: var(--full-and-sleep-top) !important;
      width: var(--full-and-sleep-width) !important;
      height: var(--full-and-sleep-height) !important;
    }

    @keyframes sleepBreath {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.05); }
    }

    /* ë ˆë²¨ì—… íš¨ê³¼ (ë¶€ë“œëŸ¬ìš´ ë²„ì „) */
    .levelup-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255, 204, 0, 0.2) 0%, transparent 70%);
      z-index: 500;
      pointer-events: none;
      animation: levelupFlash 0.6s ease-out;
    }

    @keyframes levelupFlash {
      0% { opacity: 0; transform: scale(0.8); }
      50% { opacity: 0.3; transform: scale(1); }
      100% { opacity: 0; transform: scale(1.1); }
    }

    .hamster.levelup {
      animation: hamsterLevelup 0.8s ease-out;
      filter: drop-shadow(0 0 8px rgba(255, 204, 0, 0.6));
    }

    @keyframes hamsterLevelup {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      30% { transform: translate(-50%, -50%) scale(1.1) rotate(-3deg); }
      60% { transform: translate(-50%, -50%) scale(1.15) rotate(3deg); }
    }

    .star-particle {
      position: absolute;
      color: #ffcc00;
      font-size: 20px;
      pointer-events: none;
      z-index: 600;
      opacity: 0.8;
      animation: starFloat 1.2s ease-out forwards;
    }

    @keyframes starFloat {
      0% {
        opacity: 0.8;
        transform: translate(0, 0) scale(0.6) rotate(0deg);
      }
      50% {
        opacity: 0.9;
        transform: translate(var(--star-x), var(--star-y)) scale(1.2) rotate(180deg);
      }
      100% {
        opacity: 0;
        transform: translate(calc(var(--star-x) * 1.3), calc(var(--star-y) * 1.3)) scale(0.6) rotate(360deg);
      }
    }

    /* í†µê³„ ëª¨ë‹¬ */
    .stats-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* ëª¨ë‹¬ ë’·ë°°ê²½ì€ ì‚´ì§ ì–´ë‘¡ê²Œ ìœ ì§€ (ê°€ë…ì„± ìœ„í•¨) */
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .stats-modal.show {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .stats-panel {
      position: relative;
      background-color: var(--color-ui-bg);
      border: 3px solid var(--color-text);
      border-radius: 10px;
      padding: 20px;
      padding-top: 40px;
      width: 90%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      color: var(--color-text);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .stats-panel::-webkit-scrollbar {
      width: 8px;
    }

    .stats-panel::-webkit-scrollbar-track {
      background: var(--exp-bar-bg);
      border-radius: 4px;
    }

    .stats-panel::-webkit-scrollbar-thumb {
      background: var(--color-text);
      border-radius: 4px;
    }

    .stats-title {
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .stats-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px dashed rgba(15, 56, 15, 0.3);
      font-size: 12px;
    }

    .stats-item:last-child {
      border-bottom: none;
    }

    .stats-section {
      margin-bottom: 20px;
    }

    .stats-section:last-child {
      margin-bottom: 0;
    }

    .stats-section-title {
      font-size: 13px;
      font-weight: bold;
      color: #8bac0f;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid rgba(15, 56, 15, 0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stats-notion-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .stats-notion-row .stats-section-title {
      flex-shrink: 0;
    }
    .stats-notion-btn {
      padding: 6px 12px;
      font-size: 11px;
      background: #0f380f;
      color: #9bbc0f;
      border: 2px solid #306230;
      border-radius: 4px;
      cursor: pointer;
      white-space: nowrap;
    }
    .stats-notion-btn:hover {
      background: #306230;
    }
    .stats-divider {
      margin: 8px 0 12px;
      border-top: 1px dashed rgba(15, 56, 15, 0.4);
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    .stats-label {
      color: var(--color-text);
      font-weight: bold;
    }

    .stats-value {
      color: #ffffff;
      font-weight: bold;
    }

    /* ì¶œì„ ì²´í¬ ìº˜ë¦°ë” */
    .attendance-calendar-wrap {
      margin-top: 8px;
    }
    .attendance-calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .attendance-calendar-title {
      font-size: 12px;
      font-weight: bold;
      color: var(--color-text);
    }
    .attendance-calendar-nav {
      display: flex;
      gap: 4px;
    }
    .attendance-calendar-nav button {
      padding: 2px 8px;
      font-size: 10px;
      background: var(--color-text);
      color: var(--color-ui-bg);
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .attendance-calendar-nav button:hover {
      background: #ffffff;
      color: var(--color-text);
    }
    .attendance-calendar-nav button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .attendance-calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      margin-bottom: 4px;
      font-size: 9px;
      color: rgba(255,255,255,0.8);
      text-align: center;
    }
    .attendance-calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
    }
    .attendance-day {
      aspect-ratio: 1;
      min-width: 20px;
      border-radius: 4px;
      background: rgba(15, 56, 15, 0.25);
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: rgba(255,255,255,0.4);
    }
    .attendance-day.empty {
      background: transparent;
      visibility: hidden;
    }
    /* ì¶œì„í•œ ë‚ : exp-bar-bg ë°°ê²½ + color-bg ìˆ«ì (íŒ”ë ˆíŠ¸ ë‚´ ê°•ì¡°) */
    .attendance-day.checked {
      background: var(--exp-bar-bg);
      color: var(--color-bg);
      font-weight: bold;
      border-color: var(--color-text);
      box-shadow: inset 0 0 0 1px rgba(155, 188, 15, 0.4);
    }
    /* ì˜¤ëŠ˜ + ì¶œì„: ê¸ˆìƒ‰ í…Œë‘ë¦¬ë¡œ ë”ìš± ê°•ì¡° */
    .attendance-day.checked.today {
      border: 2px solid #e6b800;
      box-shadow: inset 0 0 0 1px rgba(155, 188, 15, 0.5), 0 0 6px rgba(230, 184, 0, 0.4);
    }
    .attendance-day.today {
      border: 2px solid #e6b800;
    }

    .stats-close {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px;
      height: 32px;
      z-index: 10;
      background: var(--color-text);
      color: var(--color-ui-bg);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .stats-close:hover {
      background: #ffffff;
    }

    /* ë¬¼ ë§ˆì‹œëŠ” ëª¨ìŠµ - ë¬¼ ê¸‰ìˆ˜í†µ ìœ„ì¹˜ë¡œ ì´ë™ */
    /* 
     * ë¬¼ ê¸‰ìˆ˜í†µ í´ë¦­ ì˜ì—­ ìœ„ì¹˜ì™€ ë™ì¼í•˜ê²Œ ë§ì¶°ì£¼ì„¸ìš”.
     * .water-bottle-click-areaì˜ right, bottom ê°’ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
     * ì´ë¯¸ì§€ í¬ê¸°ëŠ” transform: scale()ë¡œ ì¡°ì ˆë©ë‹ˆë‹¤.
     */
    .hamster.drinking {
      right: 61px !important; /* ë¬¼ ê¸‰ìˆ˜í†µ ìœ„ì¹˜ (ì†Œìˆ˜ì  pxë¡œ ë¯¸ì„¸ ì¡°ì • ê°€ëŠ¥, ê°’â†‘=ì™¼ìª½) */
      bottom: 3px !important; /* ë¬¼ ê¸‰ìˆ˜í†µ í´ë¦­ ì˜ì—­ì˜ bottom ê°’ì—ì„œ í•˜ë£¨ì¹˜ ë†’ì´ë§Œí¼ ì¡°ì • */
      left: auto !important;
      top: auto !important;
      transform-origin: center center; /* í™•ëŒ€/ì¶•ì†Œ ê¸°ì¤€ì  */
    }
    
    /* drink.png ì „ìš© í¬ê¸° ì¡°ì ˆ (scale ê°’ìœ¼ë¡œ ì¡°ì •) */
    /* scale ê°’: 1.0 = 100%, 0.7 = 70%, 1.2 = 120% ë“± */
    .hamster.drinking.drink-normal {
      transform: scale(0.909) !important; /* 70% í¬ê¸°ë¡œ ì¶•ì†Œ (ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì •) */
    }
    
    /* drinkwater.png ì „ìš© í¬ê¸° ë° ìœ„ì¹˜ ì¡°ì ˆ */
    .hamster.drinking.drink-water {
      transform: scale(0.58) !important; /* 65% í¬ê¸°ë¡œ ì¶•ì†Œ (ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì •) */
      /* drinkwater ì „ìš© ìœ„ì¹˜ ì¡°ì • */
      right: 36px !important; /* ì˜¤ë¥¸ìª½ì—ì„œì˜ ê±°ë¦¬ (ê°’ì´ í´ìˆ˜ë¡ ì™¼ìª½ìœ¼ë¡œ) */
      bottom: -10px !important; /* ì•„ë˜ë¡œ ë‚´ë¦¬ë ¤ë©´ ìŒìˆ˜ ê°’ ì‚¬ìš© (ì˜ˆ: -10px, -20px, -30px) */
      /* ìœ„ë¡œ ì˜¬ë¦¬ë ¤ë©´ ì–‘ìˆ˜ ê°’ ì‚¬ìš© (ì˜ˆ: 0px, 10px, 20px) */
    }

    /* ë¬¼ë°©ìš¸ ì• ë‹ˆë©”ì´ì…˜ */
    .water-drop {
      position: absolute;
      width: 10px;
      height: 10px;
      /* ë” ì‚¬ì‹¤ì ì¸ ë¬¼ë°©ìš¸ íš¨ê³¼ */
      background: radial-gradient(
        circle at 30% 30%,
        rgba(255, 255, 255, 0.8) 0%,
        rgba(173, 216, 230, 0.9) 20%,
        rgba(135, 206, 250, 0.8) 50%,
        rgba(100, 180, 220, 0.7) 100%
      );
      border-radius: 50%;
      /* í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ (ë¹› ë°˜ì‚¬) */
      box-shadow: 
        inset -2px -2px 4px rgba(255, 255, 255, 0.5),
        inset 2px 2px 4px rgba(100, 150, 200, 0.3),
        0 2px 4px rgba(0, 0, 0, 0.2);
      pointer-events: none;
      z-index: 30;
      animation: waterDropFall 1s ease-out forwards;
    }

    @keyframes waterDropFall {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0px);
      }
      30% {
        opacity: 0.95;
        transform: translateY(20px) scale(1.1);
        filter: blur(0.5px);
      }
      60% {
        opacity: 0.85;
        transform: translateY(40px) scale(0.9);
        filter: blur(1px);
      }
      100% {
        opacity: 0;
        transform: translateY(70px) scale(0.6);
        filter: blur(2px);
      }
    }

    /* === ê²Œì„ ì‹œì‘ í™”ë©´ (ì¸ë„¤ì¼ ê¸°ë°˜) === */
    .start-screen {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: transparent;
      transition: opacity 0.6s ease-out;
    }
    .start-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .start-screen-bg {
      position: absolute;
      inset: 0;
      background: url('./assets/Thumbnail.png') center center no-repeat;
      background-size: contain;
    }
    .start-screen-content {
      position: absolute;
      inset: 0;
      z-index: 2;
    }
    /* ê²Œì„ ìŠ¤íƒ€íŠ¸ ë²„íŠ¼ (ìœ„ì¹˜/í¬ê¸° CSS ë³€ìˆ˜ë¡œ ì¡°ì ˆ, íˆ¬ëª… ì˜ì—­) */
    .game-start-btn {
      position: absolute;
      top: var(--start-btn-top);
      left: var(--start-btn-left);
      transform: translate(-50%, -50%);
      width: var(--start-btn-width);
      height: var(--start-btn-height);
      padding: 0;
      font-family: 'Press Start 2P', cursive;
      font-size: 14px;
      color: transparent;
      background: transparent;
      border: none;
      border-radius: 0;
      cursor: pointer;
      text-shadow: none;
      box-shadow: none;
      transition: none;
      z-index: 3;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .game-start-btn:hover {
      transform: translate(-50%, -50%);
    }
    /* ì‹œì‘ í™”ë©´ ì•ˆë‚´ (ì²« í„°ì¹˜ ì‹œ ì‚¬ë¼ì§) - ì™„ì „ íˆ¬ëª…(ë¹„í‘œì‹œ), ë“œë˜ê·¸ ì‹œ ì„ íƒ ë°©ì§€ */
    .start-tap-hint {
      position: absolute;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 5;
      font-size: 12px;
      color: transparent !important;
      text-shadow: none !important;
      -webkit-text-stroke: 0 transparent !important;
      opacity: 0 !important;
      pointer-events: none;
      transition: opacity 0.4s;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .start-tap-hint.hidden { opacity: 0; }
    /* ì¸ë„¤ì¼ í™”ë©´ ì œì‘ í‘œì‹œ - ì›¹/ë…¸ì…˜/ëª¨ë°”ì¼ ë™ì¼í•˜ê²Œ ìš°ì¸¡ í•˜ë‹¨ ê³ ì • */
    .credit-start {
      position: absolute;
      bottom: 12px;
      right: 12px;
      z-index: 4;
      font-family: 'Press Start 2P', 'Noto Sans KR', sans-serif;
      font-size: 10px;
      color: rgba(155, 188, 15, 0.9);
      text-shadow: 1px 1px 0 #0f380f;
      pointer-events: none;
      white-space: nowrap;
    }
    /* ê²Œì„ í™”ë©´ ì œì‘ í‘œì‹œ - ì›¹/ë…¸ì…˜/ëª¨ë°”ì¼ ë™ì¼í•˜ê²Œ ìš°ì¸¡ í•˜ë‹¨ ê³ ì • */
    .credit-game {
      position: absolute;
      bottom: 12px;
      right: 12px;
      z-index: 105;
      font-family: 'Press Start 2P', 'Noto Sans KR', sans-serif;
      font-size: 8px;
      color: rgba(155, 188, 15, 0.85);
      text-shadow: 1px 1px 0 #0f380f;
      pointer-events: none;
    }
    
    /* í”„ë¡œ ë²„ì „ ì „ìš© ìŠ¤íƒ€ì¼ (IS_PROì¼ ë•Œ ì ìš©) */
    body.app-tier-pro .credit-game::after { content: ' PRO'; opacity: 0.8; }
    body.app-tier-pro .credit-start::after { content: ' PRO'; opacity: 0.8; }
  </style>
</head>
<body id="haruchiBody">

  <!-- ì˜¤í”„ë‹ ê³¡ (ë¬´í•œ ë°˜ë³µ, ì²« í„°ì¹˜ ì‹œ ì†Œë¦¬ ON) -->
  <audio id="openingBgm" loop preload="auto" playsinline>
    <source src="./assets/audio/opening.mp3" type="audio/mpeg">
    <source src="./assets/audio/opening.MP3" type="audio/mpeg">
  </audio>
  <!-- ê²Œì„ BGM (ê²Œì„ í”Œë ˆì´ ì‹œ ì „ìš©, ë¬´í•œ ë°˜ë³µ) -->
  <audio id="gameBgm" loop preload="auto" playsinline>
    <source src="./assets/audio/game_bgm.mp3" type="audio/mpeg">
  </audio>

  <!-- ê²Œì„ ì‹œì‘ í™”ë©´ (ì¸ë„¤ì¼ ë°°ê²½) - ì²« í„°ì¹˜ ì‹œ ì˜¤í”„ë‹ ì¬ìƒ -->
  <div class="start-screen" id="startScreen">
    <div class="start-screen-bg"></div>
    <div class="start-screen-content">
      <button type="button" class="game-start-btn" id="gameStartBtn" onclick="startGame()">ê²Œì„ ìŠ¤íƒ€íŠ¸</button>
    </div>
    <div class="credit-start">ì œì‘ by bbaekyohan</div>
    <div class="start-tap-hint">í™”ë©´ì„ ëˆŒëŸ¬ ì‹œì‘</div>
  </div>

  <div class="device-wrapper" id="deviceWrapper" style="display: none;">
  <div class="scale-wrapper" id="scaleWrapper">
  <div class="device-container" id="device">
    
    <div class="panel-gap-top"></div>
    
    <div class="screen-top">
      <img src="./assets/scene/bg.png" class="bg-image" alt="ë°°ê²½">
      <img src="./assets/hamster/normal.png" class="hamster bounce" id="hamster" alt="í•˜ë£¨ì¹˜">
      <div class="grooming-overlay" id="groomingOverlay"></div>
      <div class="hamster-click-area" onclick="handleHamsterClick()" title="í´ë¦­: ì“°ë‹¤ë“¬ê¸°"></div>
      
      <div class="house-click-area" onclick="handleHouseClick()" title="í´ë¦­: ì ìê¸°"></div>
      
      <div class="bowl-click-area" onclick="handleBowlClick()" title="í´ë¦­: ë¨¹ì´ì£¼ê¸°"></div>
      
      <div class="water-bottle-click-area" onclick="handleWaterBottleClick()" title="í´ë¦­: ë¬¼ ë§ˆì‹œê¸°"></div>
      
      <div class="angry-speech-bubble" id="angrySpeechBubble">ë¹ ì§!</div>
      <div class="drink-speech-bubble" id="drinkSpeechBubble">ì±±ì±±ì±±...</div>
      <div class="butt-speech-bubble" id="buttSpeechBubble">í† ì‹¤í† ì‹¤</div>
    </div>

    <div class="panel-gap"></div>

    <div class="screen-bottom">
      <div class="panel-left" ondblclick="showStats()" style="cursor: pointer;" title="ë”ë¸”í´ë¦­: í†µê³„">
        <div class="stat-row">
          <span>LV.</span>
          <span class="val-level" id="uiLevel">1</span>
        </div>

        <div class="stat-row">
          <span>EXP</span>
          <span id="expText">0%</span>
        </div>

        <div class="exp-track">
          <div class="exp-fill" id="uiExp"></div>
        </div>

        <div class="goal-row">
          <span class="goal-label">ëª©í‘œ</span>
          <span>
            <span class="goal-progress" id="goalProgress">0/5</span>
            <span class="goal-percent" id="goalPercent">0%</span>
          </span>
        </div>

        <div class="title-row" id="titleRow">
          <span class="hamster-title" id="hamsterTitle">ìƒˆë‚´ê¸° í•˜ë£¨ì¹˜</span>
        </div>
      </div>
      <div class="panel-right log-panel-clickable" onclick="openLogModal()" title="í´ë¦­í•˜ë©´ ì „ì²´ ë¡œê·¸ ë³´ê¸°">
        <div class="log-title">SYSTEM LOG</div>
        <div class="log-content" id="uiLog">
          <div>> ì‹œìŠ¤í…œ ê°€ë™..</div>
          <div>> í•˜ë£¨ì¹˜ê°€ ê¸°ë‹¤ë ¤ìš”!</div>
        </div>
      </div>
    </div>

    <div class="layer-frame">
      <img src="./assets/scene/frame.png" class="frame-img" alt="Frame">
      <img src="./assets/logo2.png" class="device-logo" alt="Logo">
      <img src="./assets/main_logo.png" class="main-logo" alt="Main Logo">
    </div>

    <div class="btn-area btn-a" onclick="handleBtn('A')" title="ë°¥ì£¼ê¸°"></div>
    <div class="btn-area btn-b" onclick="handleBtn('B')" title="ì—‰ë©ì´ í”ë“¤ê¸°"></div>
    <div class="btn-area btn-c" onclick="handleBtn('C')" title="BGM ìŒì†Œê±°"></div>

    <div class="stats-modal" id="statsModal">
      <div class="stats-panel">
        <button class="stats-close" onclick="closeStats()">Ã—</button>
        <div class="stats-title">ğŸ“Š STATISTICS</div>
        <div id="statsContent">
          </div>
      </div>
    </div>

    <div class="stats-modal" id="logModal">
      <div class="stats-panel log-modal-panel">
        <button class="stats-close" onclick="closeLogModal()">Ã—</button>
        <div class="stats-title">ğŸ“‹ SYSTEM LOG</div>
        <div class="log-modal-content" id="logModalContent"></div>
      </div>
    </div>

  </div>
  </div>
  <div class="credit-game">ì œì‘ by bbaekyohan</div>
  </div>

  <script>
    /* í”„ë¡œ/ê¸°ë³¸ ë²„ì „: bodyì— í´ë˜ìŠ¤ ì¶”ê°€ (í”„ë¡œ ì „ìš© CSS/JS ë¶„ê¸°ìš©) */
    if (window.IS_PRO) document.body?.classList.add('app-tier-pro');

    /* ========== ë…¸ì…˜ ì—°ë™ ë¡œì§ (ì „ë¶€ ì—¬ê¸°ì„œ ê´€ë¦¬) ==========
     * [ê°ì§€] headì˜ ì¦‰ì‹œì‹¤í–‰: ?notion=1 ë˜ëŠ” iframe ì„ë² ë“œ ì‹œ html.notion-embed ì¶”ê°€
     * [ìŠ¤íƒ€ì¼] html.notion-embed: ë°°ê²½ íˆ¬ëª…, íŒ¨ë„ ì—¬ë°± ê²€ì •, ì¸ë„¤ì¼ ë¯¸ë¡œë”©
     * [ì§„ì…] ë…¸ì…˜ ëª¨ë“œ: startGame() ì¦‰ì‹œ í˜¸ì¶œ â†’ ì˜¤í”„ë‹ ìƒëµ, ë°”ë¡œ ê²Œì„
     * [XP] fetchAndApplyNotionXP(): /api/game?action=getXp í˜¸ì¶œ â†’ deltaë§Œ ì ìš©
     * [API] api/game.js: ë…¸ì…˜ API ì—°ë™ (í•˜ë£¨ì¹˜ í˜ì´ì§€ Rollup/XPë¡œê·¸ DB í•©ì‚°)
     * [ë™ê¸°í™”] notion-sync/index.js: ì†ŒìŠ¤ DB ì™„ë£Œ í•­ëª© â†’ XP ë¡œê·¸ ìƒì„± (cron ì‹¤í–‰)
     * í™˜ê²½ë³€ìˆ˜: NOTION_SETUP.md ì°¸ê³ 
     * ======================================================== */
    const NOTION_ENABLED = typeof window !== 'undefined' && document.documentElement.classList.contains('notion-embed');

    const hamster = document.getElementById('hamster');
    const uiLevel = document.getElementById('uiLevel');

    /* ì²« í„°ì¹˜ ì‹œ ì˜¤í”„ë‹ ì¬ìƒ (ë¸Œë¼ìš°ì €: ì‚¬ìš©ì ì œìŠ¤ì²˜ì¼ ë•Œë§Œ play ê°€ëŠ¥) */
    function unmuteOpening() {
      var o = document.getElementById('openingBgm');
      var h = document.querySelector('.start-tap-hint');
      if (!o) return;
      o.muted = false;
      o.volume = 0.6;
      o.currentTime = 0;
      o.play().catch(function() {});
      if (h) h.classList.add('hidden');
    }
    /* ê²Œì„ ì‹œì‘: ì˜¤í”„ë‹ ì¤‘ì§€ â†’ ê²Œì„ BGM ì¬ìƒ, í™”ë©´ ì „í™˜ */
    function startGame() {
      var opening = document.getElementById('openingBgm');
      var gameBgm = document.getElementById('gameBgm');
      if (opening) opening.pause();
      if (gameBgm) {
        gameBgm.volume = 0.6;
        gameBgm.currentTime = 0;
        gameBgm.play().catch(function() {});
      }
      var startScreen = document.getElementById('startScreen');
      var deviceWrapper = document.getElementById('deviceWrapper');
      startScreen.classList.add('hidden');
      deviceWrapper.style.display = 'flex';
      setTimeout(function() {
        startScreen.style.display = 'none';
      }, 650);
    }
    /* C ë²„íŠ¼: BGM ìŒì†Œê±° í† ê¸€ */
    function toggleBgmMute() {
      var g = document.getElementById('gameBgm');
      if (g) {
        g.muted = !g.muted;
        if (g.muted) log("ğŸ”‡ BGM ìŒì†Œê±°");
        else log("ğŸ”Š BGM ì¬ìƒ");
      }
    }
    const uiExp = document.getElementById('uiExp');
    const expText = document.getElementById('expText');
    const uiLog = document.getElementById('uiLog');

    /* ë¡œê·¸ íˆìŠ¤í† ë¦¬ (íŒì—…ìš©, ìµœëŒ€ 200ê°œ) - category: í• ì¼/ë£¨í‹´/ìš´ë™/ë…ì„œ/SNS/ëª©í‘œë³´ë„ˆìŠ¤ | ë°¥ë¨¹ê¸°/ë¬¼ë§ˆì‹œê¸°/ì“°ë‹¤ë“¬ê¸° | ë ˆë²¨ì—… | ê¸°íƒ€ */
    let logHistory = [];
    const LOG_CATEGORY_TASK = ['í• ì¼', 'ë£¨í‹´', 'ìš´ë™', 'ë…ì„œ', 'ì±…', 'SNS', 'ëª©í‘œë³´ë„ˆìŠ¤', 'ìˆ˜ë™ê¸°ë¡', 'ì¶œì„ë³´ë„ˆìŠ¤'];
    const LOG_CATEGORY_CLICK = ['ë°¥ë¨¹ê¸°', 'ë¬¼ë§ˆì‹œê¸°', 'ì“°ë‹¤ë“¬ê¸°'];

    /* ì¼ì¼ ë°¥/ë¬¼ íšŸìˆ˜ (10íšŒ ì´ìƒ ì‹œ ê³¼ë‹¤ ë°˜ì‘), ë°¥ ë¨¹ì€ ë’¤ ì§‘ í´ë¦­ ì‹œ full_and_sleep */
    const DAILY_EAT_DRINK_KEY = 'hamsterDailyEatDrink';
    const MANUAL_TASK_KEY = 'hamsterManualTaskDaily';
    const MANUAL_TASK_DAILY_LIMIT = 10;
    const MANUAL_TASK_XP_CAP = 50;
    const ATTENDANCE_REWARD_KEY = 'hamsterAttendanceRewardDate';
    /* ìŠ¤í‚¨ & ì¿ í° - ì‘ì•  í•˜ë£¨ì¹˜ ì‚¬ì „ì˜ˆì•½ í•œì • í•´ê¸ˆ */
    const SKIN_KEY = 'hamsterSkin';
    const COUPON_FOR_BABY = ['HELLO_BABY_HARUCHI']; /* ì‚¬ì „ì˜ˆì•½ ë§ˆìŠ¤í„° í‚¤ (ë©”ì¼ë¡œ ë°œì†¡) */
    /* ì—°ì† ì¶œì„ ë³´ìƒ: ë§¤ì¼ 10 XP + ë§ˆì¼ìŠ¤í†¤ (7ì¼ 50, 14ì¼ 100, 21ì¼ 150, 30ì¼ 300) */
    const ATTENDANCE_DAILY_XP = 10;
    const ATTENDANCE_MILESTONES = { 7: 50, 14: 100, 21: 150, 30: 300 };
    const MAX_EAT_BEFORE_THROWUP = 10;
    const MAX_DRINK_BEFORE_STOP = 10;
    const JUST_ATE_WINDOW_MS = 15000; /* ë°¥ ë¨¹ì€ ë’¤ ì´ ì‹œê°„ ì•ˆì— ì§‘ í´ë¦­ ì‹œ full_and_sleep */
    let justAteAt = 0;

    const EAT_DRINK_COOLDOWN_MS = 60000; /* 1ë¶„ ì¿¨ë‹¤ìš´ */
    function getDailyEatDrink() {
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      try {
        const raw = localStorage.getItem(DAILY_EAT_DRINK_KEY);
        const parsed = raw ? JSON.parse(raw) : null;
        if (parsed && parsed.date === today) {
          return {
            date: today,
            eat: parsed.eat || 0,
            drink: parsed.drink || 0,
            eatCooldownUntil: parsed.eatCooldownUntil || 0,
            drinkCooldownUntil: parsed.drinkCooldownUntil || 0
          };
        }
      } catch (_) {}
      return { date: today, eat: 0, drink: 0, eatCooldownUntil: 0, drinkCooldownUntil: 0 };
    }
    function saveDailyEatDrink(obj) {
      localStorage.setItem(DAILY_EAT_DRINK_KEY, JSON.stringify(obj));
    }

    function getDailyManualTaskCount() {
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      try {
        const raw = localStorage.getItem(MANUAL_TASK_KEY);
        const parsed = raw ? JSON.parse(raw) : null;
        if (parsed && parsed.date === today) return parsed.count || 0;
      } catch (_) {}
      return 0;
    }
    function saveDailyManualTaskCount(count) {
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      localStorage.setItem(MANUAL_TASK_KEY, JSON.stringify({ date: today, count }));
    }

    /* ìŠ¤í‚¨ ì‹œìŠ¤í…œ - ì‘ì•  í•˜ë£¨ì¹˜ í•´ê¸ˆ ìŠ¤í‚¨ */
    function getHamsterSkin() {
      try {
        const s = localStorage.getItem(SKIN_KEY);
        return (s === 'baby') ? 'baby' : 'normal';
      } catch (_) { return 'normal'; }
    }
    function setHamsterSkin(skin) {
      localStorage.setItem(SKIN_KEY, skin === 'baby' ? 'baby' : 'normal');
    }
    function getBaseHamsterSrc() {
      return getHamsterSkin() === 'baby'
        ? './assets/hamster/baby Haruchi.png'
        : './assets/hamster/normal.png';
    }
    function applyCoupon(code) {
      const raw = String(code || '').trim();
      const c = raw.toUpperCase();
      const valid = COUPON_FOR_BABY.some(k => 
        k.toUpperCase() === c || k === raw
      );
      if (valid) {
        setHamsterSkin('baby');
        const h = document.getElementById('hamster');
        if (h && !h.classList.contains('sleeping') && !h.classList.contains('drinking')) {
          h.src = getBaseHamsterSrc();
        }
        return { success: true, msg: 'ğŸ‰ ì‘ì•  í•˜ë£¨ì¹˜ ìŠ¤í‚¨ì´ í•´ê¸ˆë˜ì—ˆì–´ìš”!' };
      }
      return { success: false, msg: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì¿ í°ì´ì—ìš”.' };
    }
    function submitCoupon() {
      const input = document.getElementById('couponInput');
      const code = input ? input.value.trim() : '';
      if (!code) {
        log('ğŸ“Œ ì¿ í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.', { kind: 'system' });
        return;
      }
      const result = applyCoupon(code);
      log(result.msg, { kind: result.success ? 'important' : 'system' });
      if (result.success) {
        if (input) input.value = '';
        showStats(false);
      }
    }

    /* [ìˆ˜ì •] ì‹œì‘ ë ˆë²¨ 1, ê²½í—˜ì¹˜ 0ìœ¼ë¡œ ì´ˆê¸°í™” */
    let game = { 
      level: 1, 
      exp: 0, 
      maxExp: 100, 
      isBusy: false,
      lastActionTime: Date.now(), // ë§ˆì§€ë§‰ ì•¡ì…˜ ì‹œê°„ ì¶”ì 
      lastSadTime: 0, // ë§ˆì§€ë§‰ sad í‘œì‹œ ì‹œê°„ (ì¤‘ë³µ ë°©ì§€)
      lastAngryTime: 0, // ë§ˆì§€ë§‰ angry í‘œì‹œ ì‹œê°„ (ì¤‘ë³µ ë°©ì§€)
      lastGroomingTime: 0 // ë§ˆì§€ë§‰ ê·¸ë£¨ë° í‘œì‹œ ì‹œê°„ (ì¤‘ë³µ ë°©ì§€)
    };

    /* í†µê³„ ë°ì´í„° */
    let stats = {
      totalActions: 0,
      totalExp: 0,
      playDays: new Set(),
      firstPlayDate: null,
      lastActionDate: null,
      consecutiveDays: 0
    };

    /* ì¼ì¼ ëª©í‘œ ë°ì´í„° */
    let dailyGoal = {
      date: null,
      target: 5, // ê¸°ë³¸ ëª©í‘œ: 5ê°œ
      completed: 0,
      achieved: false // ì˜¤ëŠ˜ ëª©í‘œ ë‹¬ì„± ì—¬ë¶€
    };


    /* ë…¸ì…˜ XP ë¶ˆëŸ¬ì˜¤ê¸° (?notion=1 ëª¨ë“œ ì „ìš©) - ì•…ìš© ë°©ì§€: ì¦ê°€ë¶„ë§Œ ì ìš© */
    async function fetchAndApplyNotionXP() {
      if (!NOTION_ENABLED) return;
      try {
        const base = window.location.origin;
        const res = await fetch(base + '/api/game?action=getXp');
        const data = await res.json();
        const notionTotal = parseInt(data.totalExp, 10) || 0;
        if (notionTotal <= 0) return;
        const delta = Math.max(0, notionTotal - stats.totalExp);
        if (delta > 0) {
          stats.totalExp += delta;
          const prevLevel = game.level;
          game.level = Math.floor(stats.totalExp / game.maxExp) + 1;
          game.exp = stats.totalExp % game.maxExp;
          saveStats();
          updateUI();
          if (game.level > prevLevel) {
            logLevelUp(`â­ ë…¸ì…˜ ë™ê¸°í™”! LV.${game.level} â­`);
            showLevelUpEffect();
          } else {
            log(`ğŸ“¥ ë…¸ì…˜ì—ì„œ +${delta} XP ë¶ˆëŸ¬ì˜´`, { category: 'ë…¸ì…˜ë™ê¸°í™”', xp: delta });
          }
        }
      } catch (e) {
        console.warn('ë…¸ì…˜ XP ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
    }

    /* ë…¸ì…˜ ì™„ë£Œ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° - ì‹œìŠ¤í…œ ë¡œê·¸ì— í• ì¼/ë£¨í‹´/ìš´ë™/ë…ì„œ/SNS ì™„ë£Œ ê¸°ë¡ í‘œì‹œ */
    async function fetchAndMergeNotionLogs() {
      if (!NOTION_ENABLED) return;
      try {
        const base = window.location.origin;
        const res = await fetch(base + '/api/game?action=getLogs');
        const data = await res.json();
        const logs = data.logs || [];
        const seen = new Set(logHistory.map(e => `${e.msg}|${e.date || ''}`));
        for (const l of logs) {
          const msg = l.xp > 0 ? `${l.title} +${l.xp} XP` : l.title;
          const key = `${msg}|${l.date || ''}`;
          if (seen.has(key)) continue;
          seen.add(key);
          addToLogHistory(msg, 'normal', l.type, l.xp, l.date);
        }
      } catch (e) {
        console.warn('ë…¸ì…˜ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
    }

    /* í†µê³„ ì´ˆê¸°í™” - ë¡œì»¬ ê²½í—˜ì¹˜(ë¬¼/ë°¥/ì“°ë‹¤ë“¬ê¸° ë“±)ë¡œ ë ˆë²¨Â·EXP ë³µì› */
    function initStats() {
      const saved = localStorage.getItem('hamsterStats');
      if(saved) {
        const parsed = JSON.parse(saved);
        stats = {
          totalActions: parsed.totalActions || 0,
          totalExp: parsed.totalExp || 0,
          playDays: new Set(parsed.playDays || []),
          firstPlayDate: parsed.firstPlayDate || null,
          lastActionDate: parsed.lastActionDate || null,
          consecutiveDays: parsed.consecutiveDays || 0
        };
        /* ì €ì¥ëœ ì´ ê²½í—˜ì¹˜ë¡œ ë ˆë²¨/EXP ë³µì› */
        if (stats.totalExp > 0) {
          game.level = Math.floor(stats.totalExp / game.maxExp) + 1;
          game.exp = stats.totalExp % game.maxExp;
        }
      }

      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      if(!stats.firstPlayDate) {
        stats.firstPlayDate = today;
      }
      stats.playDays.add(today);
      saveStats();
    }

    /* ì¼ì¼ ëª©í‘œ ì´ˆê¸°í™” */
    function initDailyGoal() {
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      const saved = localStorage.getItem('hamsterDailyGoal');
      
      if(saved) {
        const parsed = JSON.parse(saved);
        if(parsed.date === today) {
          // ê°™ì€ ë‚ ì´ë©´ ë³µì›
          dailyGoal = {
            date: parsed.date,
            target: parsed.target || 5,
            completed: parsed.completed || 0,
            achieved: parsed.achieved || false
          };
        } else {
          // ìƒˆ ë‚ ì´ë©´ ë¦¬ì…‹
          dailyGoal = {
            date: today,
            target: parsed.target || 5, // ëª©í‘œëŠ” ìœ ì§€
            completed: 0,
            achieved: false
          };
          saveDailyGoal();
        }
      } else {
        dailyGoal = {
          date: today,
          target: 5,
          completed: 0,
          achieved: false
        };
        saveDailyGoal();
      }
      
      updateGoalUI();
    }

    /* ì¼ì¼ ëª©í‘œ ì €ì¥ */
    function saveDailyGoal() {
      localStorage.setItem('hamsterDailyGoal', JSON.stringify(dailyGoal));
    }

    /* ëª©í‘œ UI ì—…ë°ì´íŠ¸ */
    function updateGoalUI() {
      const goalProgress = document.getElementById('goalProgress');
      const goalPercent = document.getElementById('goalPercent');
      
      if(goalProgress && goalPercent) {
        const percent = dailyGoal.target > 0 
          ? Math.min(Math.floor((dailyGoal.completed / dailyGoal.target) * 100), 100)
          : 0;
        
        // ë” ê°„ê²°í•œ í‘œì‹œ: "3/5 60%"
        goalProgress.textContent = `${dailyGoal.completed}/${dailyGoal.target}`;
        goalPercent.textContent = `${percent}%`;
        
        // ëª©í‘œ ë‹¬ì„± ì‹œ ìƒ‰ìƒ ë³€ê²½
        if(dailyGoal.achieved || dailyGoal.completed >= dailyGoal.target) {
          goalProgress.style.color = '#ffcc00';
          goalPercent.style.color = '#ffcc00';
        } else {
          goalProgress.style.color = '#ffffff';
          goalPercent.style.color = '#ffffff';
        }
      }
    }

    /* í†µê³„ ì €ì¥ */
    function saveStats() {
      localStorage.setItem('hamsterStats', JSON.stringify({
        ...stats,
        playDays: Array.from(stats.playDays)
      }));
    }

    /* ì—°ì† ì¶œì„ ë³´ìƒ (ì˜¤ëŠ˜ 1íšŒë§Œ) */
    function applyAttendanceReward() {
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      try {
        const last = localStorage.getItem(ATTENDANCE_REWARD_KEY);
        if (last === today) return;
      } catch (_) {}
      if (stats.consecutiveDays < 1) return;

      let xp = ATTENDANCE_DAILY_XP;
      const bonus = ATTENDANCE_MILESTONES[stats.consecutiveDays];
      if (bonus) xp += bonus;

      stats.totalExp += xp;
      game.exp += xp;
      while (game.exp >= game.maxExp) {
        game.level++;
        game.exp -= game.maxExp;
        logLevelUp(`â­ LEVEL UP! LV.${game.level} â­`);
        showLevelUpEffect();
      }
      saveStats();
      localStorage.setItem(ATTENDANCE_REWARD_KEY, today);

      const msg = bonus
        ? `ğŸ“… ì—°ì† ${stats.consecutiveDays}ì¼ ì¶œì„! +${xp} XP (ë³´ë„ˆìŠ¤ +${bonus})`
        : `ğŸ“… ì—°ì† ${stats.consecutiveDays}ì¼ ì¶œì„! +${xp} XP`;
      log(msg, { category: 'ì¶œì„ë³´ë„ˆìŠ¤', xp });
      updateUI();
      updateGoalUI();
    }

    /* í†µê³„ ì—…ë°ì´íŠ¸ (ì•¡ì…˜ ì‹œ) - countsTowardGoal: í• ì¼/ë£¨í‹´/ë…ì„œ/ì±…í˜•/ìš´ë™/SNSë§Œ true, ë¬¼Â·ë°¥Â·ì“°ë‹¤ë“¬ê¸°ëŠ” false */
    function updateStats(expGained, countsTowardGoal = false) {
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      
      stats.totalActions++;
      stats.totalExp += expGained;
      stats.playDays.add(today);
      
      // ì—°ì† í”Œë ˆì´ ì¼ìˆ˜ ê³„ì‚°
      if(stats.lastActionDate) {
        const lastDate = new Date(stats.lastActionDate);
        const todayDate = new Date(today);
        const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));
        
        if(diffDays === 1) {
          stats.consecutiveDays++;
        } else if(diffDays > 1) {
          stats.consecutiveDays = 1;
        }
      } else {
        stats.consecutiveDays = 1;
      }
      
      stats.lastActionDate = today;
      saveStats();

      /* ì—°ì† ì¶œì„ ë³´ìƒ: ì˜¤ëŠ˜ ì²« ì•¡ì…˜ ì‹œ 1íšŒë§Œ (10 XP + ë§ˆì¼ìŠ¤í†¤) */
      applyAttendanceReward();

      // ì¼ì¼ ëª©í‘œ: í• ì¼/ë£¨í‹´/ë…ì„œì„¸ì…˜/ì±…í˜•/ìš´ë™/SNSë§Œ ì¹´ìš´íŠ¸ (ë¬¼Â·ë°¥Â·ì“°ë‹¤ë“¬ê¸° ì œì™¸)
      if(expGained > 0 && countsTowardGoal) {
        if(dailyGoal.date !== today) {
          dailyGoal = {
            date: today,
            target: dailyGoal.target,
            completed: 0,
            achieved: false
          };
        }
        
        dailyGoal.completed++;
        saveDailyGoal();
        
        if(!dailyGoal.achieved && dailyGoal.completed >= dailyGoal.target) {
          dailyGoal.achieved = true;
          saveDailyGoal();
          showGoalAchievedEffect();
          const bonusExp = Math.floor(expGained * 0.5);
          log(`ğŸ¯ ëª©í‘œ ë‹¬ì„±! ë³´ë„ˆìŠ¤ +${bonusExp} EXP`, { category: 'ëª©í‘œë³´ë„ˆìŠ¤', xp: bonusExp });
          game.exp += bonusExp;
          if(game.exp >= game.maxExp) {
            game.level++;
            game.exp -= game.maxExp;
            logLevelUp(`â­ LEVEL UP! LV.${game.level} â­`);
            showLevelUpEffect();
          }
          updateUI();
        }
        
        updateGoalUI();
      }
    }

    /* ì €ì¥ëœ throw up/stop drink/throw up 2/full_and_sleep ìœ„ì¹˜Â·í¬ê¸° ì ìš© (localStorage) */
    function loadSavedImagePositions() {
      const root = document.documentElement;
      try {
        let raw = localStorage.getItem('hamsterBtnTestAdjust');
        if (raw) {
          const o = JSON.parse(raw);
          if (o.left != null) root.style.setProperty('--btn-test-left', String(o.left).includes('%') ? o.left : o.left + '%');
          if (o.top != null) root.style.setProperty('--btn-test-top', String(o.top).includes('%') ? o.top : o.top + '%');
          if (o.width != null) root.style.setProperty('--btn-test-width', String(o.width).includes('px') ? o.width : o.width + 'px');
          if (o.height != null) root.style.setProperty('--btn-test-height', String(o.height).includes('px') ? o.height : o.height + 'px');
        }
        raw = localStorage.getItem('hamsterBtnTestStopDrinkAdjust');
        if (raw) {
          const o = JSON.parse(raw);
          if (o.left != null) root.style.setProperty('--btn-test-stopdrink-left', String(o.left).includes('%') ? o.left : o.left + '%');
          if (o.top != null) root.style.setProperty('--btn-test-stopdrink-top', String(o.top).includes('%') ? o.top : o.top + '%');
          if (o.width != null) root.style.setProperty('--btn-test-stopdrink-width', String(o.width).includes('px') ? o.width : o.width + 'px');
          if (o.height != null) root.style.setProperty('--btn-test-stopdrink-height', String(o.height).includes('px') ? o.height : o.height + 'px');
        }
        raw = localStorage.getItem('hamsterBtnTestThrowUp2Adjust');
        if (raw) {
          const o = JSON.parse(raw);
          if (o.left != null) root.style.setProperty('--btn-test-throwup2-left', String(o.left).includes('%') ? o.left : o.left + '%');
          if (o.top != null) root.style.setProperty('--btn-test-throwup2-top', String(o.top).includes('%') ? o.top : o.top + '%');
          if (o.width != null) root.style.setProperty('--btn-test-throwup2-width', String(o.width).includes('px') ? o.width : o.width + 'px');
          if (o.height != null) root.style.setProperty('--btn-test-throwup2-height', String(o.height).includes('px') ? o.height : o.height + 'px');
        }
        raw = localStorage.getItem('hamsterFullAndSleepAdjust');
        if (raw) {
          const o = JSON.parse(raw);
          if (o.left != null) root.style.setProperty('--full-and-sleep-left', String(o.left).includes('%') ? o.left : o.left + '%');
          if (o.top != null) root.style.setProperty('--full-and-sleep-top', String(o.top).includes('%') ? o.top : o.top + '%');
          if (o.width != null) root.style.setProperty('--full-and-sleep-width', String(o.width).includes('px') ? o.width : o.width + 'px');
          if (o.height != null) root.style.setProperty('--full-and-sleep-height', String(o.height).includes('px') ? o.height : o.height + 'px');
        }
        /* ë¡œê³  ìœ„ì¹˜: :root CSS ë³€ìˆ˜ ì‚¬ìš© */
      } catch (_) {}
    }

    function init() {
      initStats();
      initDailyGoal();
      const h = document.getElementById('hamster');
      if (h) h.src = getBaseHamsterSrc();
      updateUI();
      if (NOTION_ENABLED) {
        fetchAndApplyNotionXP();
        fetchAndMergeNotionLogs(); /* ë…¸ì…˜ ì™„ë£Œ ë¡œê·¸ â†’ ì‹œìŠ¤í…œ ë¡œê·¸ */
        setInterval(fetchAndMergeNotionLogs, 60000); /* 60ì´ˆë§ˆë‹¤ ìƒˆ ì™„ë£Œ ë¡œê·¸ ê°±ì‹  */
      }
      fitScale();
      window.addEventListener('resize', fitScale);
      loadSavedImagePositions();

      /* ì´ˆê¸° ë¡œê·¸ íˆìŠ¤í† ë¦¬ (íŒì—…ìš©) */
      if (logHistory.length === 0) {
        logHistory = [
          { msg: 'ì‹œìŠ¤í…œ ê°€ë™..', kind: 'normal', category: null, xp: null, date: new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', dateStyle: 'short', timeStyle: 'short' }) },
          { msg: 'í•˜ë£¨ì¹˜ê°€ ê¸°ë‹¤ë ¤ìš”!', kind: 'normal', category: null, xp: null, date: new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', dateStyle: 'short', timeStyle: 'short' }) }
        ];
      }

      // sad ì´ë¯¸ì§€ ëœë¤ í‘œì‹œ ì²´í¬ ì‹œì‘
      startSadCheckTimer();

      // ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ì²´í¬ ì‹œì‘
      startGroomingCheckTimer();
    }

    function fitScale() {
      const device = document.getElementById('device');
      const scaleWrapper = document.getElementById('scaleWrapper');
      const fw = 673, fh = 673;
      const pad = 20;
      const embedScale = 1.0; /* ê²Œì„ í™”ë©´ ë°°ìœ¨ (1.0 = ê¸°ë³¸, ì¤„ì´ë ¤ë©´ 0.9 ë“±) */
      let scale = Math.min(
        (window.innerWidth - pad) / fw,
        (window.innerHeight - pad) / fh
      );
      scale = Math.min(scale * embedScale, 1.2); /* ìµœëŒ€ 1.2ë°°ê¹Œì§€ */
      scaleWrapper.style.width = (fw * scale) + 'px';
      scaleWrapper.style.height = (fh * scale) + 'px';
      device.style.transform = `scale(${scale})`;
    }

    function handleBtn(btn) {
      if(game.isBusy) {
        const lastEmotionTime = Math.max(game.lastSadTime, game.lastAngryTime);
        if(Math.random() < 0.05 && Date.now() - lastEmotionTime > 10000) {
          showSadOrAngryRandomly();
        }
        return;
      }
      if(btn === 'A') {
        log("í•˜ë£¨ì¹˜ ê·¸ë£¨ë° ì¤‘ ...");
        game.isBusy = false;
        showGroomingAnimation();
      } else if(btn === 'B') {
        showButtAction();
      } else if(btn === 'C') {
        toggleBgmMute();
      }
    }

    /* í•˜ë£¨ì¹˜ í´ë¦­ í•¸ë“¤ëŸ¬ (ì“°ë‹¤ë“¬ê¸°) */
    function handleHamsterClick() {
      if(game.isBusy) {
        // ë²„íŠ¼ì´ ì•ˆ ëˆŒëŸ¬ì§ˆ ë•Œ ê°€ë”ì”© sad/angry í‘œì‹œ (5% í™•ë¥ , 70% sad, 30% angry)
        const lastEmotionTime = Math.max(game.lastSadTime, game.lastAngryTime);
        if(Math.random() < 0.05 && Date.now() - lastEmotionTime > 10000) {
          showSadOrAngryRandomly();
        }
        return;
      }
      game.isBusy = true;
      game.lastActionTime = Date.now(); // ì•¡ì…˜ ì‹œê°„ ì—…ë°ì´íŠ¸
      log("ì“°ë‹´ì“°ë‹´.. ê¸°ë¶„ ìµœê³ ! +5", { category: 'ì“°ë‹¤ë“¬ê¸°', xp: 5 });
      changeAction('./assets/hamster/happy.png', 2000);
      showExpParticle(5);
      addExp(5);
      updateStats(5, false);  /* ì“°ë‹¤ë“¬ê¸°: ëª©í‘œ ë¯¸í¬í•¨ */
    }

    /* ì§‘ í´ë¦­ í•¸ë“¤ëŸ¬ - ë°¥ ë¨¹ì€ ë’¤ ì¼ì • ì‹œê°„ ì•ˆì— í´ë¦­ ì‹œ full_and_sleep (ë°¥ ë¨¹ê³  ìë©´ ê¸°ë¶„ ì¢‹ë‹¤) */
    function handleHouseClick() {
      if(game.isBusy) {
        const lastEmotionTime = Math.max(game.lastSadTime, game.lastAngryTime);
        if(Math.random() < 0.05 && Date.now() - lastEmotionTime > 10000) {
          showSadOrAngryRandomly();
        }
        return;
      }
      game.isBusy = true;
      game.lastActionTime = Date.now();
      const useFullAndSleep = justAteAt > 0 && (Date.now() - justAteAt) < JUST_ATE_WINDOW_MS;
      justAteAt = 0;
      if (useFullAndSleep) {
        log("ë°¥ ë¨¹ê³  ì ë“¤ì—ˆì–´ìš”.. ê¸°ë¶„ ì¢‹ì•„ìš” ğŸ˜´");
        changeSleepAction(5000, 'assets/hamster/overfed/full_and_sleep.png', 'full-and-sleep-adjust');
      } else {
        log("ì§‘ì— ë“¤ì–´ê°€ì„œ ì ìê¸°... Zzz +0");
        changeSleepAction(5000);
      }
      addExp(0);
    }

    /* ê·¸ë¦‡ í´ë¦­ - 10íšŒ ì‹œ throw up, 1ë¶„ ì¿¨ë‹¤ìš´ ì¤‘ ì‹œ stop drink, 1ë¶„ í›„ ë‹¤ì‹œ í™œì„±í™” */
    function handleBowlClick() {
      if(game.isBusy) {
        const lastEmotionTime = Math.max(game.lastSadTime, game.lastAngryTime);
        if(Math.random() < 0.05 && Date.now() - lastEmotionTime > 10000) {
          showSadOrAngryRandomly();
        }
        return;
      }
      const daily = getDailyEatDrink();
      const now = Date.now();
      if (daily.eat >= MAX_EAT_BEFORE_THROWUP) {
        if (daily.eatCooldownUntil && now > daily.eatCooldownUntil) {
          daily.eat = 0;
          daily.eatCooldownUntil = 0;
          saveDailyEatDrink(daily);
        } else if (daily.eatCooldownUntil && now <= daily.eatCooldownUntil) {
          game.isBusy = true;
          log("ì ê¹ë§Œìš”, ë” ì´ìƒ ëª» ë¨¹ì–´ìš”! ğŸ˜£");
          hamster.classList.add('btn-test-stopdrink');
          hamster.src = 'assets/hamster/overfed/stop drink.png';
          hamster.classList.remove('bounce', 'sleeping');
          hamster.onerror = function() {
            hamster.src = getBaseHamsterSrc();
            hamster.classList.add('bounce');
            hamster.classList.remove('btn-test-stopdrink');
            game.isBusy = false;
            hamster.onerror = null;
          };
          setTimeout(() => {
            hamster.src = getBaseHamsterSrc();
            hamster.classList.add('bounce');
            hamster.classList.remove('btn-test-stopdrink');
            hamster.onerror = null;
            game.isBusy = false;
          }, 2500);
          return;
        } else {
          game.isBusy = true;
          log("ë„ˆë¬´ ë§ì´ ë¨¹ì—ˆì–´ìš”! ğŸ˜µ");
          hamster.classList.add('btn-test-adjust');
          changeAction('assets/hamster/overfed/throw up.png', 2500);
          daily.eatCooldownUntil = now + EAT_DRINK_COOLDOWN_MS;
          saveDailyEatDrink(daily);
          setTimeout(() => { hamster.classList.remove('btn-test-adjust'); game.isBusy = false; }, 2500);
          return;
        }
      }
      game.isBusy = true;
      game.lastActionTime = Date.now();
      daily.eat++;
      saveDailyEatDrink(daily);
      justAteAt = Date.now();
      
      const eatMessages = [
        "ëƒ ëƒ ! í•´ë°”ë¼ê¸°ì”¨ ë§›ìˆë‹¤ +10",
        "ëƒ ëƒ ! í•´ë°”ë¼ê¸°ì”¨ ë§›ìˆë‹¤ ì•¼ë¥´~ +10",
        "í•˜ë£¨ì¹˜ ë‘ì«€ì¿  ë¨¹ê³  ì‹¶ë‹¤ +10",
        "ì•¼ë¯¸~ ì•¼ë¯¸~ ì•¼ë¯¸ì•¼ë¯¸ì•¼ë¯¸ +10"
      ];
      const randomMessage = eatMessages[Math.floor(Math.random() * eatMessages.length)];
      log(randomMessage, { category: 'ë°¥ë¨¹ê¸°', xp: 10 });

      changeAction('./assets/hamster/eat.png', 2000);
      showExpParticle(10);
      addExp(10);
      updateStats(10, false);
    }

    /* ë¬¼ ê¸‰ìˆ˜í†µ í´ë¦­ - 10íšŒ ì‹œ throw up 2, 1ë¶„ ì¿¨ë‹¤ìš´ ì¤‘ ì‹œ stop drink, 1ë¶„ í›„ ë‹¤ì‹œ í™œì„±í™” */
    function handleWaterBottleClick() {
      if(game.isBusy) {
        const lastEmotionTime = Math.max(game.lastSadTime, game.lastAngryTime);
        if(Math.random() < 0.05 && Date.now() - lastEmotionTime > 10000) {
          showSadOrAngryRandomly();
        }
        return;
      }
      const daily = getDailyEatDrink();
      const now = Date.now();
      if (daily.drink >= MAX_DRINK_BEFORE_STOP) {
        if (daily.drinkCooldownUntil && now > daily.drinkCooldownUntil) {
          daily.drink = 0;
          daily.drinkCooldownUntil = 0;
          saveDailyEatDrink(daily);
        } else if (daily.drinkCooldownUntil && now <= daily.drinkCooldownUntil) {
          game.isBusy = true;
          log("ë¬¼ ë” ì´ìƒ ë§ˆì‹œê¸° ì‹«ì–´ìš”! ğŸ˜£");
          hamster.classList.add('btn-test-stopdrink');
          hamster.src = 'assets/hamster/overfed/stop drink.png';
          hamster.classList.remove('bounce', 'sleeping', 'drinking');
          hamster.onerror = function() {
            hamster.src = getBaseHamsterSrc();
            hamster.classList.add('bounce');
            hamster.classList.remove('btn-test-stopdrink');
            game.isBusy = false;
            hamster.onerror = null;
          };
          setTimeout(() => {
            hamster.src = getBaseHamsterSrc();
            hamster.classList.add('bounce');
            hamster.classList.remove('btn-test-stopdrink');
            hamster.onerror = null;
            game.isBusy = false;
          }, 2500);
          return;
        } else {
          game.isBusy = true;
          log("ë¬¼ ë„ˆë¬´ ë§ì´ ë§ˆì…¨ì–´ìš”! ğŸ˜µ");
          hamster.classList.add('btn-test-throwup2');
          hamster.src = 'assets/hamster/overfed/throw up 2.png';
          hamster.classList.remove('bounce', 'sleeping', 'drinking');
          hamster.onerror = function() {
            hamster.src = getBaseHamsterSrc();
            hamster.classList.add('bounce');
            hamster.classList.remove('btn-test-throwup2');
            game.isBusy = false;
            hamster.onerror = null;
          };
          daily.drinkCooldownUntil = now + EAT_DRINK_COOLDOWN_MS;
          saveDailyEatDrink(daily);
          setTimeout(() => {
            hamster.src = getBaseHamsterSrc();
            hamster.classList.add('bounce');
            hamster.classList.remove('btn-test-throwup2');
            hamster.onerror = null;
            game.isBusy = false;
          }, 2500);
          return;
        }
      }
      game.isBusy = true;
      game.lastActionTime = Date.now();
      daily.drink++;
      saveDailyEatDrink(daily);
      
      const useDrinkWater = Math.random() < 0.2;
      const drinkImage = useDrinkWater ? './assets/hamster/drinkwater.png' : './assets/hamster/drink.png';
      if(useDrinkWater) {
        log("ë²Œì»¥ë²Œì»¥! ë¬¼ì„ ë§ˆì‹œëŠ” ì¤‘... +10", { category: 'ë¬¼ë§ˆì‹œê¸°', xp: 10 });
      } else {
        log("ë¬¼ì„ ë§ˆì‹œëŠ” ì¤‘... +10", { category: 'ë¬¼ë§ˆì‹œê¸°', xp: 10 });
      }
      changeDrinkAction(drinkImage, 2000);
      showExpParticle(10);
      addExp(10);
      updateStats(10, false);
    }

    /* ë¬¼ 10íšŒ ì´ìƒ ì‹œ ë¬¼ ê¸‰ìˆ˜í†µ ìª½ì— throw up 2 ì˜¤ë²„ë ˆì´ í‘œì‹œ */
    function showThrowUp2NearWaterBottle() {
      const screenTop = document.querySelector('.screen-top');
      if (!screenTop) return;
      const overlay = document.createElement('div');
      overlay.className = 'throwup2-overlay';
      const img = document.createElement('img');
      img.src = 'assets/hamster/overfed/throw up 2.png';
      img.alt = '';
      overlay.appendChild(img);
      screenTop.appendChild(overlay);
      setTimeout(() => overlay.remove(), 2500);
    }

    /* ì´ë¯¸ì§€ ì‚¬ë¼ì§ ë°©ì§€ */
    function changeAction(imgSrc, duration) {
      const originalSrc = getBaseHamsterSrc();
      hamster.src = imgSrc;
      hamster.classList.remove('bounce', 'sleeping');
      
      // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì›ìƒë³µêµ¬
      hamster.onerror = function() {
        console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:", imgSrc);
        log("âš  ì˜¤ë¥˜: ì´ë¯¸ì§€ê°€ ì—†ì–´ìš”!");
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('sleeping');
        game.isBusy = false;
      };

      setTimeout(() => {
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('sleeping');
        game.isBusy = false;
        hamster.onerror = null; 
      }, duration);
    }

    /* ì ìëŠ” ëª¨ìŠµ (ì˜¤ë¥¸ìª½ ì§‘ ì•ˆ) - sleepImageSrc ìƒëµ ì‹œ sleep.png, ë°¥ ë¨¹ê³  ì ë“¤ë©´ full_and_sleep.png. adjustClass ìˆìœ¼ë©´ í•´ë‹¹ í´ë˜ìŠ¤ë¡œ ìœ„ì¹˜Â·í¬ê¸° ì ìš© */
    function changeSleepAction(duration, sleepImageSrc, adjustClass) {
      const originalSrc = getBaseHamsterSrc();
      const sleepImg = sleepImageSrc || './assets/hamster/sleep.png';
      hamster.src = sleepImg;
      hamster.classList.remove('bounce');
      hamster.classList.add('sleeping');
      if (adjustClass) hamster.classList.add(adjustClass);
      
      hamster.onerror = function() {
        console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:", sleepImg);
        log("âš  ì˜¤ë¥˜: ì ìëŠ” ì´ë¯¸ì§€ê°€ ì—†ì–´ìš”!");
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('sleeping');
        if (adjustClass) hamster.classList.remove(adjustClass);
        game.isBusy = false;
      };

      setTimeout(() => {
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('sleeping');
        if (adjustClass) hamster.classList.remove(adjustClass);
        game.isBusy = false;
        hamster.onerror = null;
      }, duration);
    }

    /* ë¬¼ ë§ˆì‹œëŠ” ëª¨ìŠµ (ë¬¼ ê¸‰ìˆ˜í†µ ìœ„ì¹˜ë¡œ ì´ë™) */
    function changeDrinkAction(imgSrc, duration) {
      const originalSrc = getBaseHamsterSrc();
      
      // ì´ë¯¸ì§€ì— ë”°ë¼ ë‹¤ë¥¸ í¬ê¸° í´ë˜ìŠ¤ ì„¤ì •
      const isDrinkWater = imgSrc.includes('drinkwater');
      const sizeClass = isDrinkWater ? 'drink-water' : 'drink-normal';
      
      // ë¬¼ ê¸‰ìˆ˜í†µ ìœ„ì¹˜ë¡œ ì´ë™
      hamster.src = imgSrc;
      hamster.classList.remove('bounce', 'sleeping', 'drink-normal', 'drink-water');
      hamster.classList.add('drinking', sizeClass);
      
      // ë¬¼ ë§ˆì‹œëŠ” ë§í’ì„  í‘œì‹œ (ì±±ì±±ì±±... / í• ì§í• ì§ ëœë¤)
      const drinkBubble = document.getElementById('drinkSpeechBubble');
      const drinkBubbleTexts = ['ì±±ì±±ì±±...', 'í• ì§í• ì§'];
      if(drinkBubble) {
        drinkBubble.textContent = drinkBubbleTexts[Math.floor(Math.random() * drinkBubbleTexts.length)];
        drinkBubble.classList.add('show');
      }
      
      // ë¬¼ë°©ìš¸ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      startWaterDropAnimation(duration);
      
      // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì›ìƒë³µêµ¬
      hamster.onerror = function() {
        console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:", imgSrc);
        log("âš  ì˜¤ë¥˜: ë¬¼ ë§ˆì‹œëŠ” ì´ë¯¸ì§€ê°€ ì—†ì–´ìš”!");
        hamster.src = originalSrc;
        hamster.classList.remove('drinking', 'drink-normal', 'drink-water');
        hamster.classList.add('bounce');
        const drinkBubble = document.getElementById('drinkSpeechBubble');
        if(drinkBubble) drinkBubble.classList.remove('show');
        game.isBusy = false;
      };

      setTimeout(() => {
        hamster.src = originalSrc;
        hamster.classList.remove('drinking', 'drink-normal', 'drink-water');
        hamster.classList.add('bounce');
        const drinkBubble = document.getElementById('drinkSpeechBubble');
        if(drinkBubble) drinkBubble.classList.remove('show');
        game.isBusy = false;
        hamster.onerror = null;
      }, duration);
    }

    /* ë¬¼ë°©ìš¸ ì• ë‹ˆë©”ì´ì…˜ */
    function startWaterDropAnimation(duration) {
      const screenTop = document.querySelector('.screen-top');
      const waterBottleArea = document.querySelector('.water-bottle-click-area');
      
      if (!screenTop || !waterBottleArea) return;
      
      // ë¬¼ ê¸‰ìˆ˜í†µ í´ë¦­ ì˜ì—­ì˜ ì‹¤ì œ ìœ„ì¹˜ ê³„ì‚°
      const bottleRect = waterBottleArea.getBoundingClientRect();
      const screenRect = screenTop.getBoundingClientRect();
      
      // CSS ë³€ìˆ˜ì—ì„œ ì˜¤í”„ì…‹ ê°’ ê°€ì ¸ì˜¤ê¸°
      // í˜„ì¬ ìµœì  ìœ„ì¹˜: X=-115px, Y=-90px (ë¬¼ ê¸‰ìˆ˜í†µì— ì–´ìš¸ë¦¬ëŠ” ìœ„ì¹˜)
      const rootStyles = getComputedStyle(document.documentElement);
      const offsetX = parseFloat(rootStyles.getPropertyValue('--water-drop-offset-x')) || -80;
      const offsetY = parseFloat(rootStyles.getPropertyValue('--water-drop-offset-y')) || -65;
      
      // ë¬¼ë°©ìš¸ì´ ë–¨ì–´ì§€ëŠ” ì‹œì‘ ìœ„ì¹˜ (ë¬¼ ê¸‰ìˆ˜í†µ ì•„ë˜ìª½ ì¤‘ì•™)
      // ë¬¼ ê¸‰ìˆ˜í†µ í´ë¦­ ì˜ì—­ì˜ ì¤‘ì•™ X ìœ„ì¹˜, í•˜ë‹¨ Y ìœ„ì¹˜
      const baseX = bottleRect.left + bottleRect.width / 2 - screenRect.left;
      const baseY = bottleRect.bottom - screenRect.top;
      
      // CSS ë³€ìˆ˜ë¡œ ì„¤ì •í•œ ì˜¤í”„ì…‹ ì ìš©
      const startX = baseX + offsetX;
      const startY = baseY + offsetY;
      
      // ë¬¼ ë§ˆì‹œëŠ” ë™ì•ˆ ì—¬ëŸ¬ ê°œì˜ ë¬¼ë°©ìš¸ ìƒì„±
      const dropCount = 12; // ì´ 8ê°œì˜ ë¬¼ë°©ìš¸
      
      for (let i = 0; i < dropCount; i++) {
        setTimeout(() => {
          createWaterDrop(screenTop, startX, startY);
        }, i * (duration / dropCount));
      }
    }

    /* ë¬¼ë°©ìš¸ ìƒì„± */
    function createWaterDrop(container, x, y) {
      const drop = document.createElement('div');
      drop.className = 'water-drop';
      
      // ì•½ê°„ì˜ ëœë¤ ì˜¤í”„ì…‹ ì¶”ê°€
      const offsetX = (Math.random() - 0.5) * 20;
      drop.style.left = (x + offsetX) + 'px';
      drop.style.top = y + 'px';
      
      container.appendChild(drop);
      
      // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„ ì œê±°
      setTimeout(() => {
        if (drop.parentNode) {
          drop.parentNode.removeChild(drop);
        }
      }, 1000);
    }

    /* sad ë˜ëŠ” angry ì´ë¯¸ì§€ ëœë¤ í‘œì‹œ (70% sad, 30% angry) */
    function showSadOrAngryRandomly(forceShow = false) {
      // forceShowê°€ falseì´ê³ , ì´ë¯¸ busy ìƒíƒœì´ê±°ë‚˜ ìµœê·¼ì— ê°ì •ì„ í‘œì‹œí–ˆë‹¤ë©´ ê±´ë„ˆë›°ê¸°
      const lastEmotionTime = Math.max(game.lastSadTime, game.lastAngryTime);
      if(!forceShow && (game.isBusy || Date.now() - lastEmotionTime < 10000)) {
        return;
      }
      
      // 70% sad, 30% angry ëœë¤ ì„ íƒ
      const isAngry = Math.random() < 0.3;
      
      if(isAngry) {
        showAngryRandomly(forceShow);
      } else {
        showSadRandomly(forceShow);
      }
    }

    /* sad ì´ë¯¸ì§€ ëœë¤ í‘œì‹œ */
    function showSadRandomly(forceShow = false) {
      // forceShowê°€ falseì´ê³ , ì´ë¯¸ busy ìƒíƒœì´ê±°ë‚˜ ìµœê·¼ì— sadë¥¼ í‘œì‹œí–ˆë‹¤ë©´ ê±´ë„ˆë›°ê¸°
      if(!forceShow && (game.isBusy || Date.now() - game.lastSadTime < 10000)) {
        return;
      }
      
      game.isBusy = true;
      game.lastSadTime = Date.now();
      
      // ëœë¤ sad ë©”ì‹œì§€ ë°°ì—´
      const sadMessages = [
        "ğŸ˜¢ í•˜ë£¨ì¹˜ê°€ ìŠ¬í¼ ë³´ì—¬ìš”...",
        "ğŸ˜ í•˜ë£¨ì¹˜ê°€ ì™¸ë¡œì›Œí•˜ëŠ” ê²ƒ ê°™ì•„ìš”",
        "ğŸ˜” í•˜ë£¨ì¹˜ê°€ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”...",
        "ğŸ’” í•˜ë£¨ì¹˜ê°€ ê´€ì‹¬ì„ ì›í•´ìš”",
        "ğŸ˜¿ í•˜ë£¨ì¹˜ê°€ ì“¸ì“¸í•´ ë³´ì—¬ìš”",
        "ğŸ˜° í•˜ë£¨ì¹˜ê°€ ë¶ˆì•ˆí•´í•˜ëŠ” ê²ƒ ê°™ì•„ìš”",
        "ğŸ˜¥ í•˜ë£¨ì¹˜ê°€ ì‹¬ì‹¬í•´í•˜ëŠ” ê²ƒ ê°™ì•„ìš”",
        "ğŸ˜ª í•˜ë£¨ì¹˜ê°€ ì§€ì³ ë³´ì—¬ìš”...",
        "ğŸ˜“ í•˜ë£¨ì¹˜ê°€ í˜ë“¤ì–´í•˜ëŠ” ê²ƒ ê°™ì•„ìš”",
        "ğŸ˜­ í•˜ë£¨ì¹˜ê°€ ìš¸ê³  ìˆì–´ìš”..."
      ];
      
      // ëœë¤ìœ¼ë¡œ ë©”ì‹œì§€ ì„ íƒ
      const randomMessage = sadMessages[Math.floor(Math.random() * sadMessages.length)];
      log(randomMessage);
      
      const originalSrc = getBaseHamsterSrc();
      hamster.src = 'assets/hamster/sad.png';
      hamster.classList.remove('bounce', 'sleeping', 'drinking');
      
      // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì›ìƒë³µêµ¬
      hamster.onerror = function() {
        console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: sad.png");
        log("âš  ì˜¤ë¥˜: sad ì´ë¯¸ì§€ê°€ ì—†ì–´ìš”!");
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        game.isBusy = false;
        hamster.onerror = null;
      };
      
      // 2-4ì´ˆ ì‚¬ì´ ëœë¤í•˜ê²Œ í‘œì‹œ
      const duration = 2000 + Math.random() * 2000;
      
      setTimeout(() => {
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        game.isBusy = false;
        hamster.onerror = null;
      }, duration);
    }

    /* angry ì´ë¯¸ì§€ ëœë¤ í‘œì‹œ (back.png - ì‚ì ¸ì„œ ë’¤ëŒì•„ ì„  ëª¨ìŠµ + ì˜¤ë¥¸ìª½ ë§í’ì„  ë¹ ì§) */
    function showAngryRandomly(forceShow = false) {
      // forceShowê°€ falseì´ê³ , ì´ë¯¸ busy ìƒíƒœì´ê±°ë‚˜ ìµœê·¼ì— angryë¥¼ í‘œì‹œí–ˆë‹¤ë©´ ê±´ë„ˆë›°ê¸°
      if(!forceShow && (game.isBusy || Date.now() - game.lastAngryTime < 10000)) {
        return;
      }
      
      game.isBusy = true;
      game.lastAngryTime = Date.now();
      
      // ëœë¤ angry ë©”ì‹œì§€ ë°°ì—´
      const angryMessages = [
        "ğŸ˜  í•˜ë£¨ì¹˜ê°€ í™”ê°€ ë‚¬ì–´ìš”!",
        "ğŸ˜¡ í•˜ë£¨ì¹˜ê°€ ë§¤ìš° í™”ê°€ ë‚˜ìˆì–´ìš”!",
        "ğŸ’¢ í•˜ë£¨ì¹˜ê°€ ì§œì¦ì´ ë‚¬ì–´ìš”!",
        "ğŸ¤¬ í•˜ë£¨ì¹˜ê°€ í™”ê°€ ë‚˜ì„œ ë– ë“¤ì–´ìš”!",
        "ğŸ˜¤ í•˜ë£¨ì¹˜ê°€ ë¶ˆë§Œì´ ë§ì•„ìš”!",
        "ğŸ’¥ í•˜ë£¨ì¹˜ê°€ í­ë°œ ì§ì „ì´ì—ìš”!"
      ];
      
      // ëœë¤ìœ¼ë¡œ ë©”ì‹œì§€ ì„ íƒ
      const randomMessage = angryMessages[Math.floor(Math.random() * angryMessages.length)];
      log(randomMessage);
      
      const originalSrc = getBaseHamsterSrc();
      hamster.src = 'assets/hamster/back.png';
      hamster.classList.remove('bounce', 'sleeping', 'drinking');
      hamster.classList.add('angry');
      
      // ì˜¤ë¥¸ìª½ ë§í’ì„  ë¹ ì§ í‘œì‹œ
      const speechBubble = document.getElementById('angrySpeechBubble');
      const angryBubbleTexts = ['ë¹ ì§!', 'ì°ì°!', 'ì°!!', '...'];
      if(speechBubble) {
        speechBubble.textContent = angryBubbleTexts[Math.floor(Math.random() * angryBubbleTexts.length)];
        speechBubble.classList.add('show');
      }
      
      // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì›ìƒë³µêµ¬
      hamster.onerror = function() {
        console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: back.png");
        log("âš  ì˜¤ë¥˜: back ì´ë¯¸ì§€ê°€ ì—†ì–´ìš”!");
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('angry');
        if(speechBubble) speechBubble.classList.remove('show');
        game.isBusy = false;
        hamster.onerror = null;
      };
      
      // 3-5ì´ˆ ì‚¬ì´ ëœë¤í•˜ê²Œ í‘œì‹œ (sadë³´ë‹¤ ì¡°ê¸ˆ ë” ê¸¸ê²Œ)
      const duration = 3000 + Math.random() * 2000;
      
      setTimeout(() => {
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('angry');
        if(speechBubble) speechBubble.classList.remove('show');
        game.isBusy = false;
        hamster.onerror = null;
      }, duration);
    }

    /* C ë²„íŠ¼: í™”ë‚œ ëª¨ìŠµ (angry.png - ì •ë©´ í™”ë‚œ í‘œì •) */
    function showAngryFaceAction() {
      if(game.isBusy) return;
      
      game.isBusy = true;
      
      const angryMessages = [
        "ğŸ˜  í•˜ë£¨ì¹˜ê°€ í™”ê°€ ë‚¬ì–´ìš”!",
        "ğŸ˜¡ í•˜ë£¨ì¹˜ê°€ ë§¤ìš° í™”ê°€ ë‚˜ìˆì–´ìš”!",
        "ğŸ’¢ í•˜ë£¨ì¹˜ê°€ ì§œì¦ì´ ë‚¬ì–´ìš”!"
      ];
      log(angryMessages[Math.floor(Math.random() * angryMessages.length)]);
      
      const originalSrc = getBaseHamsterSrc();
      hamster.src = './assets/hamster/angry.png';
      hamster.classList.remove('bounce', 'sleeping', 'drinking');
      
      const speechBubble = document.getElementById('angrySpeechBubble');
      const angryBubbleTexts = ['ë¹ ì§!', 'ë¹ ì§!!', 'ë¹ ì•…!', 'ì³‡!'];
      if(speechBubble) {
        speechBubble.textContent = angryBubbleTexts[Math.floor(Math.random() * angryBubbleTexts.length)];
        speechBubble.classList.add('show');
      }
      
      hamster.onerror = function() {
        console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: angry.png");
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        if(speechBubble) speechBubble.classList.remove('show');
        game.isBusy = false;
        hamster.onerror = null;
      };
      
      const duration = 2500 + Math.random() * 1500;
      setTimeout(() => {
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        if(speechBubble) speechBubble.classList.remove('show');
        game.isBusy = false;
        hamster.onerror = null;
      }, duration);
    }

    /* B ë²„íŠ¼: ë’¤íƒœ (back.png) - ì”°ë£©ì”°ë£©(ì—‰ë©ì´ í”ë“¤ë¦¼) / í† ì‹¤í† ì‹¤(ê·€ì—¬ìš´ ì—‰ë©ì´) */
    function showButtAction() {
      if(game.isBusy) return;
      
      game.isBusy = true;
      
      const isWiggle = Math.random() < 0.5; // 50% ì”°ë£©ì”°ë£©, 50% í† ì‹¤í† ì‹¤
      const bubbleText = isWiggle ? 'ì”°ë£©ì”°ë£©' : 'í† ì‹¤í† ì‹¤';
      
      log(isWiggle ? 'ğŸ‘ í•˜ë£¨ì¹˜ ì—‰ë©ì´ê°€ ì”°ë£©ì”°ë£©~' : 'ğŸ‘ í•˜ë£¨ì¹˜ í† ì‹¤í† ì‹¤í•œ ì—‰ë©ì´!');
      
      const originalSrc = getBaseHamsterSrc();
      hamster.src = 'assets/hamster/back.png';
      hamster.classList.remove('bounce', 'sleeping', 'drinking', 'angry');
      hamster.classList.add('butt');
      if(isWiggle) hamster.classList.add('butt-wiggle');
      
      const buttBubble = document.getElementById('buttSpeechBubble');
      if(buttBubble) {
        buttBubble.textContent = bubbleText;
        buttBubble.classList.add('show');
      }
      
      hamster.onerror = function() {
        console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: back.png");
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('butt', 'butt-wiggle');
        if(buttBubble) buttBubble.classList.remove('show');
        game.isBusy = false;
        hamster.onerror = null;
      };
      
      const duration = 2500 + Math.random() * 1000;
      setTimeout(() => {
        hamster.src = originalSrc;
        hamster.classList.add('bounce');
        hamster.classList.remove('butt', 'butt-wiggle');
        if(buttBubble) buttBubble.classList.remove('show');
        game.isBusy = false;
        hamster.onerror = null;
      }, duration);
    }

    /* ì¥ì‹œê°„ ëŒ€ê¸° ì‹œ sad/angry ì²´í¬ íƒ€ì´ë¨¸ */
    function startSadCheckTimer() {
      // 30ì´ˆë§ˆë‹¤ ì²´í¬
      setInterval(() => {
        if(!game.isBusy) {
          const idleTime = Date.now() - game.lastActionTime;
          const lastEmotionTime = Math.max(game.lastSadTime, game.lastAngryTime);
          
          // 5ë¶„(300ì´ˆ) ì´ìƒ ë°©ì¹˜ ì‹œ angry 1% í™•ë¥ 
          if(idleTime >= 300000) {
            if(Math.random() < 0.01 && Date.now() - lastEmotionTime > 60000) {
              showAngryRandomly();
              return;
            }
          }
          
          // 2ë¶„(120ì´ˆ) ì´ìƒ ëŒ€ê¸° ì¤‘ì¼ ë•Œ sad/angry ëœë¤ (70% sad, 30% angry)
          if(idleTime >= 120000) {
            // 3% í™•ë¥ ë¡œ ê°ì • í‘œì‹œ (ê°€ë”ì”©ë§Œ)
            if(Math.random() < 0.03 && Date.now() - lastEmotionTime > 30000) {
              showSadOrAngryRandomly();
            }
          }
        }
      }, 30000); // 30ì´ˆë§ˆë‹¤ ì²´í¬
    }

    /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ë³€ìˆ˜ */
    let groomingAnimationInterval = null;
    let currentGroomingFrame = 0;
    const GROOMING_FRAME_COUNT = 16; // ì´ 16í”„ë ˆì„
    const GROOMING_FRAME_WIDTH = 64; // ì›ë³¸ 1í”„ë ˆì„ ë„ˆë¹„ (256px / 4)
    const GROOMING_FRAME_HEIGHT = 64; // ì›ë³¸ 1í”„ë ˆì„ ë†’ì´ (256px / 4)
    const DISPLAY_FRAME_WIDTH = 200; // ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ í¬ê¸° (ì˜¤ë²„ë ˆì´ í¬ê¸°ì— ë§ì¶¤)
    const DISPLAY_FRAME_HEIGHT = 200; // ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ í¬ê¸° (ì˜¤ë²„ë ˆì´ í¬ê¸°ì— ë§ì¶¤)
    
    /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ì†ë„ (CSS ë³€ìˆ˜ì—ì„œ ì½ì–´ì˜´, ê¸°ë³¸ê°’ 120ms) */
    function getGroomingAnimationSpeed(frameIndex = null) {
      const rootStyles = getComputedStyle(document.documentElement);
      
      // í”„ë ˆì„ë³„ ê°œë³„ ì†ë„ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      if(frameIndex !== null) {
        const frameSpeed = rootStyles.getPropertyValue(`--grooming-frame-${frameIndex}-speed`);
        if(frameSpeed && frameSpeed.trim() !== '') {
          const speed = parseFloat(frameSpeed.replace('ms', '').trim());
          if(speed > 0) return speed;
        }
      }
      
      // ê¸°ë³¸ ì†ë„ ì‚¬ìš©
      const speedValue = rootStyles.getPropertyValue('--grooming-animation-speed') || '120ms';
      const speed = parseFloat(speedValue.replace('ms', '')) || 120;
      return speed;
    }
    
    /* í”„ë ˆì„ í™€ë“œ ë°°ìˆ˜ ê°€ì ¸ì˜¤ê¸° */
    function getGroomingFrameHold() {
      const rootStyles = getComputedStyle(document.documentElement);
      const holdValue = rootStyles.getPropertyValue('--grooming-frame-hold') || '1';
      return parseFloat(holdValue) || 1;
    }
    
    /* ì• ë‹ˆë©”ì´ì…˜ ë°˜ë³µ íšŸìˆ˜ ê°€ì ¸ì˜¤ê¸° */
    function getGroomingRepeatCount() {
      const rootStyles = getComputedStyle(document.documentElement);
      const repeatValue = rootStyles.getPropertyValue('--grooming-repeat-count') || '1';
      return parseFloat(repeatValue) || 1;
    }

    /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ ì—…ë°ì´íŠ¸ */
    function updateGroomingFrame() {
      const groomingOverlay = document.getElementById('groomingOverlay');
      if(!groomingOverlay) return;
      
      // í˜„ì¬ í”„ë ˆì„ ì¸ë±ìŠ¤ë¡œ ì—´(col)ê³¼ í–‰(row) ê³„ì‚°
      const col = currentGroomingFrame % 4; // 0~3
      const row = Math.floor(currentGroomingFrame / 4); // 0~3
      
      // ì˜¤ë²„ë ˆì´ í¬ê¸° ê°€ì ¸ì˜¤ê¸° (ë™ì ìœ¼ë¡œ ê³„ì‚°)
      const frameWidth = window.currentDisplayFrameWidth || DISPLAY_FRAME_WIDTH;
      const frameHeight = window.currentDisplayFrameHeight || DISPLAY_FRAME_HEIGHT;
      
      // ê° í–‰(row)ë³„ X, Y ì˜¤í”„ì…‹ì„ CSS ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°
      const rootStyles = getComputedStyle(document.documentElement);
      const rowYOffsets = [
        parseFloat(rootStyles.getPropertyValue('--grooming-row-0-y-offset')) || 0,
        parseFloat(rootStyles.getPropertyValue('--grooming-row-1-y-offset')) || 0,
        parseFloat(rootStyles.getPropertyValue('--grooming-row-2-y-offset')) || 0,
        parseFloat(rootStyles.getPropertyValue('--grooming-row-3-y-offset')) || 0
      ];
      const rowXOffsets = [
        parseFloat(rootStyles.getPropertyValue('--grooming-row-0-x-offset')) || 0,
        parseFloat(rootStyles.getPropertyValue('--grooming-row-1-x-offset')) || 0,
        parseFloat(rootStyles.getPropertyValue('--grooming-row-2-x-offset')) || 0,
        parseFloat(rootStyles.getPropertyValue('--grooming-row-3-x-offset')) || 0
      ];
      
      // background-positionì„ ìŒìˆ˜ í”½ì…€ ê°’ìœ¼ë¡œ ê³„ì‚° (X ì˜¤í”„ì…‹ ì ìš©)
      const baseX = -col * frameWidth;
      const rowXOffset = rowXOffsets[row] || 0;
      const x = baseX + rowXOffset;
      
      // y ìœ„ì¹˜ ê³„ì‚°: ê¸°ë³¸ ìœ„ì¹˜ + í–‰ë³„ ì˜¤í”„ì…‹
      const baseY = -row * frameHeight;
      const rowYOffset = rowYOffsets[row] || 0;
      const y = baseY + rowYOffset;
      
      // background-position ì—…ë°ì´íŠ¸ (ì˜¤ë²„ë ˆì´ divì— ì ìš©)
      groomingOverlay.style.backgroundPosition = `${x}px ${y}px`;
      
      // ë‹¤ìŒ í”„ë ˆì„ìœ¼ë¡œ ì´ë™
      currentGroomingFrame++;
    }

    /* ê·¸ë£¨ë° í”„ë ˆì„ ìë™ ì •ë ¬ - ëª¨ë“  í”„ë ˆì„ì´ ê°™ì€ ìœ„ì¹˜ì— ì˜¤ë„ë¡ ìë™ ì¡°ì • */
    function autoAlignGroomingFrames() {
      const groomingOverlay = document.getElementById('groomingOverlay');
      if(!groomingOverlay) {
        log("âš  ê·¸ë£¨ë° ì˜¤ë²„ë ˆì´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      
      // ì˜¤ë²„ë ˆì´ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
      const overlayWidth = parseInt(window.getComputedStyle(groomingOverlay).width) || 290;
      const overlayHeight = parseInt(window.getComputedStyle(groomingOverlay).height) || 290;
      
      // ê¸°ì¤€ í”„ë ˆì„(í”„ë ˆì„ 0)ì˜ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •
      const referenceFrame = 0;
      const referenceRow = Math.floor(referenceFrame / 4);
      const referenceCol = referenceFrame % 4;
      
      // ê¸°ì¤€ í”„ë ˆì„ì˜ ê¸°ë³¸ Y ìœ„ì¹˜ (ì˜¤í”„ì…‹ ì—†ì´)
      const referenceBaseY = -referenceRow * overlayHeight;
      // ê¸°ì¤€ í”„ë ˆì„ì˜ ê¸°ë³¸ X ìœ„ì¹˜ (ì˜¤í”„ì…‹ ì—†ì´, ì»¬ëŸ¼ 0 ê¸°ì¤€)
      const referenceBaseX = -referenceCol * overlayWidth;
      
      // ê° í–‰ì˜ ì˜¤í”„ì…‹ì„ ê³„ì‚°í•˜ì—¬ ëª¨ë“  í”„ë ˆì„ì´ ê°™ì€ Y, X ìœ„ì¹˜ì— ì˜¤ë„ë¡ ì¡°ì •
      const rowYOffsets = [];
      const rowXOffsets = [];
      
      for(let row = 0; row < 4; row++) {
        // ê° í–‰ì˜ ê¸°ë³¸ Y ìœ„ì¹˜
        const baseY = -row * overlayHeight;
        
        // ê¸°ì¤€ í”„ë ˆì„ê³¼ ê°™ì€ Y ìœ„ì¹˜ì— ì˜¤ë„ë¡ í•„ìš”í•œ ì˜¤í”„ì…‹ ê³„ì‚°
        const neededYOffset = referenceBaseY - baseY;
        rowYOffsets[row] = neededYOffset;
        
        // ê° í–‰ì˜ ì²« ë²ˆì§¸ í”„ë ˆì„(ì»¬ëŸ¼ 0)ì˜ ê¸°ë³¸ X ìœ„ì¹˜
        const baseX = -0 * overlayWidth; // í•­ìƒ 0ì´ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œ
        
        // ê¸°ì¤€ í”„ë ˆì„ê³¼ ê°™ì€ X ìœ„ì¹˜ì— ì˜¤ë„ë¡ í•„ìš”í•œ ì˜¤í”„ì…‹ ê³„ì‚°
        const neededXOffset = referenceBaseX - baseX;
        rowXOffsets[row] = neededXOffset;
      }
      
      // CSS ë³€ìˆ˜ì— ì ìš©
      for(let i = 0; i < 4; i++) {
        document.documentElement.style.setProperty(`--grooming-row-${i}-y-offset`, `${rowYOffsets[i]}px`);
        document.documentElement.style.setProperty(`--grooming-row-${i}-x-offset`, `${rowXOffsets[i]}px`);
      }
      
      // ì• ë‹ˆë©”ì´ì…˜ì´ ì‹¤í–‰ ì¤‘ì´ë©´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
      if(groomingAnimationInterval) {
        updateGroomingFrame();
      }
    }
    
    /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ */
    function showGroomingAnimation() {
      // ì´ë¯¸ busy ìƒíƒœì´ê±°ë‚˜ ìµœê·¼ì— ê·¸ë£¨ë°ì„ í‘œì‹œí–ˆë‹¤ë©´ ê±´ë„ˆë›°ê¸°
      if(game.isBusy || Date.now() - game.lastGroomingTime < 20000) {
        return;
      }
      
      // ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ì´ ì‹¤í–‰ ì¤‘ì´ë©´ ì •ë¦¬
      if(groomingAnimationInterval) {
        clearInterval(groomingAnimationInterval);
        groomingAnimationInterval = null;
      }
      
      game.isBusy = true;
      game.lastGroomingTime = Date.now();
      
      // img íƒœê·¸ë¥¼ ìˆ¨ê¸°ê³  ì˜¤ë²„ë ˆì´ div í‘œì‹œ
      hamster.classList.remove('bounce', 'sleeping', 'drinking');
      hamster.classList.add('grooming');
      
      // normal ì´ë¯¸ì§€ ì™„ì „íˆ ìˆ¨ê¸°ê¸°
      hamster.style.opacity = '0';
      hamster.style.visibility = 'hidden';
      
      const groomingOverlay = document.getElementById('groomingOverlay');
      if(groomingOverlay) {
        // ì˜¤ë²„ë ˆì´ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
        const overlayWidth = parseInt(window.getComputedStyle(groomingOverlay).width);
        const overlayHeight = parseInt(window.getComputedStyle(groomingOverlay).height);
        
        // background-sizeë¥¼ ì˜¤ë²„ë ˆì´ í¬ê¸°ì— ë§ì¶° ë™ì ìœ¼ë¡œ ì„¤ì • (4x4 ê·¸ë¦¬ë“œ)
        groomingOverlay.style.backgroundSize = `${overlayWidth * 4}px ${overlayHeight * 4}px`;
        
        // overflow: hiddenìœ¼ë¡œ ì˜ì—­ ë°–ì˜ ì´ë¯¸ì§€ ìˆ¨ê¹€
        groomingOverlay.style.overflow = 'hidden';
        
        // ìœ„ì¹˜ ê³ ì • (CSS ë³€ìˆ˜ ì‚¬ìš©)
        const rootStyles = getComputedStyle(document.documentElement);
        const groomingTop = rootStyles.getPropertyValue('--grooming-top') || '68%';
        const groomingLeft = rootStyles.getPropertyValue('--grooming-left') || '50%';
        const groomingOffsetX = rootStyles.getPropertyValue('--grooming-offset-x') || '0px';
        const groomingOffsetY = rootStyles.getPropertyValue('--grooming-offset-y') || '0px';
        
        groomingOverlay.style.top = `calc(${groomingTop} + ${groomingOffsetY})`;
        groomingOverlay.style.left = `calc(${groomingLeft} + ${groomingOffsetX})`;
        groomingOverlay.style.transform = 'translate(-50%, -50%)';
        
        groomingOverlay.classList.add('active');
        
        // DISPLAY_FRAME_WIDTH/HEIGHTë¥¼ ì˜¤ë²„ë ˆì´ í¬ê¸°ì— ë§ì¶° ì—…ë°ì´íŠ¸
        window.currentDisplayFrameWidth = overlayWidth;
        window.currentDisplayFrameHeight = overlayHeight;
      }
      
      // ìë™ ì •ë ¬ ì‹¤í–‰ (ìœ„/ì•„ë˜, ì™¼ìª½/ì˜¤ë¥¸ìª½ ëª¨ë‘ ì •ë ¬)
      autoAlignGroomingFrames();
      
      // í”„ë ˆì„ ì¸ë±ìŠ¤ ì´ˆê¸°í™”
      currentGroomingFrame = 0;
      
      // ì²« í”„ë ˆì„ ì„¤ì •
      updateGroomingFrame();
      
      // í”„ë ˆì„ í™€ë“œ ë°°ìˆ˜ ê°€ì ¸ì˜¤ê¸°
      const frameHold = getGroomingFrameHold();
      // ë°˜ë³µ íšŸìˆ˜ ê°€ì ¸ì˜¤ê¸°
      const repeatCount = getGroomingRepeatCount();
      let holdCount = 0;
      let animationCycle = 0; // ì• ë‹ˆë©”ì´ì…˜ ì‚¬ì´í´ ì¹´ìš´í„°
      
      // ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ ì§„í–‰ í•¨ìˆ˜
      function advanceFrame() {
        holdCount++;
        
        // í”„ë ˆì„ í™€ë“œë§Œí¼ ë°˜ë³µí–ˆìœ¼ë©´ ë‹¤ìŒ í”„ë ˆì„ìœ¼ë¡œ
        if(holdCount >= frameHold) {
          holdCount = 0;
          updateGroomingFrame();
          
          // ëª¨ë“  í”„ë ˆì„ì´ ì¬ìƒë˜ì—ˆìœ¼ë©´
          if(currentGroomingFrame >= GROOMING_FRAME_COUNT) {
            animationCycle++;
            
            // ì§€ì •ëœ íšŸìˆ˜ë§Œí¼ ë°˜ë³µí•˜ì§€ ì•Šì•˜ìœ¼ë©´ ë‹¤ì‹œ ì‹œì‘
            if(animationCycle < repeatCount) {
              currentGroomingFrame = 0;
              updateGroomingFrame();
              return;
            }
            
            // ëª¨ë“  ë°˜ë³µì´ ëë‚¬ìœ¼ë©´ ì¢…ë£Œ
            if(groomingAnimationInterval) {
              clearInterval(groomingAnimationInterval);
              groomingAnimationInterval = null;
            }
            
            // ì›ìƒë³µêµ¬
            hamster.classList.remove('grooming');
            hamster.classList.add('bounce');
            hamster.style.opacity = '';
            hamster.style.visibility = '';
            hamster.style.backgroundImage = '';
            hamster.style.backgroundSize = '';
            hamster.style.backgroundPosition = '';
            hamster.style.backgroundRepeat = '';
            
            if(groomingOverlay) {
              groomingOverlay.classList.remove('active');
            }
            
            currentGroomingFrame = 0;
            game.isBusy = false;
            return;
          }
        }
        
        // í˜„ì¬ í”„ë ˆì„ì˜ ì†ë„ë¡œ ë‹¤ìŒ ì¸í„°ë²Œ ì„¤ì • (í”„ë ˆì„ë³„ ê°€ë³€ ì†ë„ ì ìš©)
        // updateGroomingFrame()ì—ì„œ ì´ë¯¸ currentGroomingFrame++ë¥¼ í–ˆìœ¼ë¯€ë¡œ í˜„ì¬ í”„ë ˆì„ ì¸ë±ìŠ¤ ì‚¬ìš©
        const currentFrameIndex = currentGroomingFrame < GROOMING_FRAME_COUNT ? currentGroomingFrame : 0;
        const currentSpeed = getGroomingAnimationSpeed(currentFrameIndex);
        if(groomingAnimationInterval) {
          clearInterval(groomingAnimationInterval);
          groomingAnimationInterval = setInterval(advanceFrame, currentSpeed);
        }
      }
      
      // setIntervalë¡œ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ (í”„ë ˆì„ë³„ ê°€ë³€ ì†ë„ ì ìš©)
      groomingAnimationInterval = setInterval(advanceFrame, getGroomingAnimationSpeed(currentGroomingFrame));
    }

    /* ê·¸ë£¨ë° ì• ë‹ˆë©”ì´ì…˜ ì²´í¬ íƒ€ì´ë¨¸ */
    function startGroomingCheckTimer() {
      // 20ì´ˆë§ˆë‹¤ ì²´í¬
      setInterval(() => {
        // busy ìƒíƒœê°€ ì•„ë‹ˆê³ , normal ìƒíƒœì¼ ë•Œë§Œ
        if(!game.isBusy && !hamster.classList.contains('sleeping') && 
           !hamster.classList.contains('drinking') && 
           !hamster.classList.contains('grooming')) {
          
          // 30ì´ˆ ì´ìƒ ëŒ€ê¸° ì¤‘ì¼ ë•Œ 5% í™•ë¥ ë¡œ ê·¸ë£¨ë°
          const idleTime = Date.now() - game.lastActionTime;
          if(idleTime >= 30000) {
            if(Math.random() < 0.05 && Date.now() - game.lastGroomingTime > 20000) {
              showGroomingAnimation();
            }
          }
        }
      }, 20000); // 20ì´ˆë§ˆë‹¤ ì²´í¬
    }

    function addExp(amount) {
      game.exp += amount;
      if(game.exp >= game.maxExp) {
        game.level++;
        game.exp -= game.maxExp;
        logLevelUp(`â­ LEVEL UP! LV.${game.level} â­`);
        showLevelUpEffect();
      }
      updateUI();
    }

    /* EXP íŒŒí‹°í´ íš¨ê³¼ */
    function showExpParticle(amount) {
      // í•˜ë£¨ì¹˜ ë¨¸ë¦¬ ìœ„ ìœ„ì¹˜ ê³„ì‚° (ì•¡ì…˜ê³¼ ì§ì ‘ ì—°ê²°)
      const hamsterRect = hamster.getBoundingClientRect();
      const centerX = hamsterRect.left + hamsterRect.width / 2;
      const headY = hamsterRect.top + 50; // í•˜ë£¨ì¹˜ ë¨¸ë¦¬ ë” ì•„ë˜ìª½
      
      const particle = document.createElement('div');
      particle.className = 'exp-particle';
      particle.textContent = `+${amount}`;
      particle.style.left = centerX + 'px';
      particle.style.top = headY + 'px';
      particle.style.transform = 'translate(-50%, 0)';
      
      document.body.appendChild(particle);
      setTimeout(() => particle.remove(), 1500);
    }

    /* ë ˆë²¨ì—… í™”ë ¤í•œ íš¨ê³¼ (ë¶€ë“œëŸ¬ìš´ ë²„ì „) */
    function showLevelUpEffect() {
      // í™”ë©´ í”Œë˜ì‹œ íš¨ê³¼ (ë¶€ë“œëŸ½ê²Œ)
      const flash = document.createElement('div');
      flash.className = 'levelup-flash';
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 600);

      // í•˜ë£¨ì¹˜ ë°˜ì§ì„ íš¨ê³¼ (ë¶€ë“œëŸ½ê²Œ)
      hamster.classList.add('levelup');
      setTimeout(() => {
        hamster.classList.remove('levelup');
      }, 800);

      // ë³„ íŒŒí‹°í´ íš¨ê³¼ (ê°œìˆ˜ ì¤„ì´ê³  ë¶€ë“œëŸ½ê²Œ)
      const hamsterRect = hamster.getBoundingClientRect();
      const centerX = hamsterRect.left + hamsterRect.width / 2;
      const centerY = hamsterRect.top + hamsterRect.height / 2;
      
      const starCount = 8; // 12ê°œì—ì„œ 8ê°œë¡œ ì¤„ì„
      for(let i = 0; i < starCount; i++) {
        const angle = (360 / starCount) * i;
        const distance = 60 + Math.random() * 30; // ê±°ë¦¬ ì¤„ì„
        const radian = (angle * Math.PI) / 180;
        const x = Math.cos(radian) * distance;
        const y = Math.sin(radian) * distance;
        
        const star = document.createElement('div');
        star.className = 'star-particle';
        star.textContent = 'â­';
        star.style.left = centerX + 'px';
        star.style.top = centerY + 'px';
        star.style.setProperty('--star-x', x + 'px');
        star.style.setProperty('--star-y', y + 'px');
        
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 1200);
      }
    }

    /* í†µê³„ ëª¨ë‹¬ ê´€ë ¨ */

    /* ì¶œì„ ìº˜ë¦°ë” ë³´ëŠ” ë‹¬ (ì „ì—­) */
    let attendanceViewYear = new Date().getFullYear();
    let attendanceViewMonth = new Date().getMonth();

    /* ì´ë²ˆ ë‹¬ ì¶œì„ ì¼ìˆ˜ */
    function getMonthlyAttendanceCount(year, month) {
      if (!year) year = new Date().getFullYear();
      if (month === undefined) month = new Date().getMonth();
      let count = 0;
      stats.playDays.forEach(d => {
        const [y, m] = d.split('-').map(Number);
        if (y === year && m === month + 1) count++;
      });
      return count;
    }

    /* ì¶œì„ ìº˜ë¦°ë” - ì›”ë³„ ë‹¬ë ¥ í˜•íƒœ (ì¼~í† ) */
    function getAttendanceCalendarHTML(year, month) {
      if (!year) year = attendanceViewYear;
      if (month === undefined) month = attendanceViewMonth;
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      const monthNames = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
      const weekdays = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startWeekday = firstDay.getDay();
      const daysInMonth = lastDay.getDate();
      const viewMonthCount = getMonthlyAttendanceCount(year, month);

      let weekdaysHtml = weekdays.map(w => `<span>${w}</span>`).join('');
      let cellsHtml = '';
      const emptyCells = startWeekday;
      for (let i = 0; i < emptyCells; i++) {
        cellsHtml += '<div class="attendance-day empty"></div>';
      }
      for (let d = 1; d <= daysInMonth; d++) {
        const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const checked = stats.playDays.has(dateStr);
        const isToday = dateStr === today;
        cellsHtml += `<div class="attendance-day ${checked ? 'checked' : ''} ${isToday ? 'today' : ''}" title="${dateStr} ${checked ? 'ì¶œì„' : 'ë¯¸ì¶œì„'}">${d}</div>`;
      }
      return {
        title: `${year}ë…„ ${monthNames[month]}`,
        weekdays: weekdaysHtml,
        cells: cellsHtml,
        count: viewMonthCount
      };
    }

    function changeAttendanceMonth(delta) {
      const now = new Date();
      const maxYear = now.getFullYear();
      const maxMonth = now.getMonth();
      attendanceViewMonth += delta;
      if (attendanceViewMonth > 11) {
        attendanceViewMonth = 0;
        attendanceViewYear++;
      } else if (attendanceViewMonth < 0) {
        attendanceViewMonth = 11;
        attendanceViewYear--;
      }
      if (attendanceViewYear > maxYear || (attendanceViewYear === maxYear && attendanceViewMonth > maxMonth)) {
        attendanceViewYear = maxYear;
        attendanceViewMonth = maxMonth;
      }
      showStats(false);
    }

    function canGoNextMonth() {
      const now = new Date();
      return attendanceViewYear < now.getFullYear() || (attendanceViewYear === now.getFullYear() && attendanceViewMonth < now.getMonth());
    }

    function showStats(resetCalendarToCurrent) {
      const modal = document.getElementById('statsModal');
      const content = document.getElementById('statsContent');
      if (resetCalendarToCurrent !== false) {
        const now = new Date();
        attendanceViewYear = now.getFullYear();
        attendanceViewMonth = now.getMonth();
      }
      
      const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
      const playDaysCount = stats.playDays.size;
      const avgDailyExp = playDaysCount > 0 ? Math.floor(stats.totalExp / playDaysCount) : 0;
      const goalPercent = dailyGoal.target > 0 
        ? Math.min(Math.floor((dailyGoal.completed / dailyGoal.target) * 100), 100)
        : 0;
      const cal = getAttendanceCalendarHTML();
      
      const manualCount = getDailyManualTaskCount();
      const manualRemain = Math.max(0, MANUAL_TASK_DAILY_LIMIT - manualCount);
      content.innerHTML = `
        <div class="stats-section" id="manualTaskSection">
          ${NOTION_ENABLED ? `
          <div class="stats-notion-row">
            <span class="stats-section-title" style="margin-bottom:0; border:none; padding:0;">ğŸ“Œ ë…¸ì…˜ ì—°ë™</span>
            <button onclick="fetchAndApplyNotionXP()" class="stats-notion-btn">ë…¸ì…˜ì—ì„œ XP ë¶ˆëŸ¬ì˜¤ê¸°</button>
          </div>
          <div class="stats-divider"></div>
          ` : ''}
          <div class="stats-section-title">âœ í•  ì¼ ì§ì ‘ ê¸°ë¡ <span style="opacity:0.8; font-size:10px;">(ì˜¤ëŠ˜ ${manualCount}/${MANUAL_TASK_DAILY_LIMIT}ê±´)</span></div>
          ${manualRemain > 0 ? `
          <div class="stats-item" style="flex-wrap: wrap; gap: 6px;">
            <button type="button" onclick="addManualTask('ë¬¼ ë§ˆì‹œê¸°', 10)" style="padding: 6px 10px; font-size: 10px; background: #0f380f; color: #9bbc0f; border: 1px solid #306230; border-radius: 4px; cursor: pointer;">ë¬¼ 10</button>
            <button type="button" onclick="addManualTask('ë°¥ ë¨¹ê¸°', 10)" style="padding: 6px 10px; font-size: 10px; background: #0f380f; color: #9bbc0f; border: 1px solid #306230; border-radius: 4px; cursor: pointer;">ë°¥ 10</button>
            <button type="button" onclick="addManualTask('ì“°ë‹¤ë“¬ê¸°', 5)" style="padding: 6px 10px; font-size: 10px; background: #0f380f; color: #9bbc0f; border: 1px solid #306230; border-radius: 4px; cursor: pointer;">ì“°ë‹´ 5</button>
            <button type="button" onclick="addManualTask('ìš´ë™', 20)" style="padding: 6px 10px; font-size: 10px; background: #0f380f; color: #9bbc0f; border: 1px solid #306230; border-radius: 4px; cursor: pointer;">ìš´ë™ 20</button>
            <button type="button" onclick="addManualTask('ë…ì„œ', 40)" style="padding: 6px 10px; font-size: 10px; background: #0f380f; color: #9bbc0f; border: 1px solid #306230; border-radius: 4px; cursor: pointer;">ë…ì„œ 40</button>
          </div>
          <div class="stats-item" style="flex-wrap: wrap; align-items: center; gap: 6px;">
            <input type="text" id="manualTaskName" placeholder="í•  ì¼ ì´ë¦„" maxlength="30"
                   onkeydown="if(event.key==='Enter')submitManualTaskCustom()"
                   style="width: 90px; padding: 6px 8px; font-size: 11px; background: rgba(15,56,15,0.8); border: 2px solid #0f380f; color: #fff; border-radius: 4px;">
            <select id="manualTaskXp" style="padding: 6px 8px; font-size: 11px; background: rgba(15,56,15,0.8); border: 2px solid #0f380f; color: #fff; border-radius: 4px; width: 60px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="15">15</option>
              <option value="20">20</option>
              <option value="30">30</option>
              <option value="40">40</option>
              <option value="50">50</option>
            </select>
            <span style="font-size: 10px; opacity: 0.9;">XP</span>
            <button type="button" onclick="submitManualTaskCustom()" style="padding: 6px 10px; font-size: 10px; background: #306230; color: #9bbc0f; border: 1px solid #306230; border-radius: 4px; cursor: pointer;">ì¶”ê°€</button>
          </div>
          ` : `
          <div class="stats-item" style="color: #8b7355;">ì˜¤ëŠ˜ ê¸°ë¡ í•œë„(10ê±´)ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</div>
          `}
        </div>
        <div class="stats-section">
          <div class="stats-section-title">ğŸ“Š í†µê³„</div>
          <div class="stats-item">
            <span class="stats-label">ì´ í”Œë ˆì´ ì¼ìˆ˜</span>
            <span class="stats-value">${playDaysCount}ì¼</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">ì´ ì•¡ì…˜ íšŸìˆ˜</span>
            <span class="stats-value">${stats.totalActions}íšŒ</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">ì´ íšë“ EXP</span>
            <span class="stats-value">${stats.totalExp}ì </span>
          </div>
          <div class="stats-item">
            <span class="stats-label">í‰ê·  ì¼ì¼ EXP</span>
            <span class="stats-value">${avgDailyExp}ì </span>
          </div>
          <div class="stats-item">
            <span class="stats-label">í˜„ì¬ ë ˆë²¨</span>
            <span class="stats-value">LV.${game.level}</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">ì²« í”Œë ˆì´</span>
            <span class="stats-value">${stats.firstPlayDate || 'ì˜¤ëŠ˜'}</span>
          </div>
        </div>

        <div class="stats-section">
          <div class="stats-section-title">ğŸ“… ì¶œì„ ì²´í¬</div>
          <div class="stats-item">
            <span class="stats-label">ì—°ì† ì¶œì„</span>
            <span class="stats-value">${stats.consecutiveDays}ì¼ ${stats.consecutiveDays >= 7 ? 'ğŸ”¥' : ''}</span>
          </div>
          <div class="stats-item" style="font-size: 10px; opacity: 0.85;">
            <span class="stats-label">ë³´ìƒ</span>
            <span class="stats-value">ë§¤ì¼ 10 XP Â· 7ì¼ +50 Â· 14ì¼ +100 Â· 21ì¼ +150 Â· 30ì¼ +300</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">ì´ë²ˆ ë‹¬ ì¶œì„</span>
            <span class="stats-value">${getMonthlyAttendanceCount()}ì¼</span>
          </div>
          <div class="attendance-calendar-wrap">
            <div class="attendance-calendar-header">
              <span class="attendance-calendar-title">${cal.title} (${cal.count}ì¼ ì¶œì„)</span>
              <div class="attendance-calendar-nav">
                <button type="button" onclick="changeAttendanceMonth(-1)">â—€ ì´ì „</button>
                <button type="button" onclick="changeAttendanceMonth(1)" ${!canGoNextMonth() ? 'disabled' : ''}>ë‹¤ìŒ â–¶</button>
              </div>
            </div>
            <div class="attendance-calendar-weekdays">${cal.weekdays}</div>
            <div class="attendance-calendar">${cal.cells}</div>
          </div>
        </div>
        
        <div class="stats-section">
          <div class="stats-section-title">ğŸ¯ ì¼ì¼ ëª©í‘œ</div>
          <div class="stats-item">
            <span class="stats-label">ì˜¤ëŠ˜ ì™„ë£Œ</span>
            <span class="stats-value" id="statsGoalCompleteValue">${dailyGoal.completed}/${dailyGoal.target} (${goalPercent}%)</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">ëª©í‘œ ì„¤ì •</span>
            <span class="stats-value">
              <input type="number" id="goalInput" min="1" max="50" value="${dailyGoal.target}" 
                     style="width: 50px; padding: 4px; font-size: 11px; text-align: center; 
                            background: rgba(15,56,15,0.8); border: 2px solid #0f380f; 
                            color: #ffffff; border-radius: 4px;">
              <button onclick="saveGoal()" style="margin-left: 8px; padding: 4px 8px; 
                     font-size: 10px; background: #0f380f; color: #9bbc0f; 
                     border: 2px solid #0f380f; border-radius: 4px; cursor: pointer;">ì €ì¥</button>
            </span>
          </div>
          ${dailyGoal.achieved ? '<div class="stats-item" id="statsGoalAchievedMsg" style="color: #ffcc00; font-weight: bold;">âœ¨ ì˜¤ëŠ˜ ëª©í‘œ ë‹¬ì„±!</div>' : ''}
        </div>

        <div class="stats-section">
          <div class="stats-section-title">ğŸ ì¿ í° ì…ë ¥</div>
          <div class="stats-item" style="flex-wrap: wrap; align-items: center; gap: 6px;">
            <input type="text" id="couponInput" placeholder="ì‚¬ì „ì˜ˆì•½ ì¿ í° ì…ë ¥" maxlength="30"
                   onkeydown="if(event.key==='Enter')submitCoupon()"
                   style="flex: 1; min-width: 120px; padding: 6px 10px; font-size: 11px; 
                          background: rgba(15,56,15,0.8); border: 2px solid #0f380f; 
                          color: #fff; border-radius: 4px;">
            <button type="button" onclick="submitCoupon()"
                    style="padding: 6px 12px; font-size: 11px; background: #306230; color: #9bbc0f; 
                           border: 2px solid #306230; border-radius: 4px; cursor: pointer;">ë“±ë¡</button>
          </div>
          <div class="stats-item" style="font-size: 10px; opacity: 0.85;">
            ${getHamsterSkin() === 'baby' 
              ? 'ğŸ¹ ì‘ì•  í•˜ë£¨ì¹˜ ìŠ¤í‚¨ ì ìš© ì¤‘!' 
              : 'ì‚¬ì „ì˜ˆì•½ ì¿ í°ìœ¼ë¡œ ì‘ì•  í•˜ë£¨ì¹˜ ìŠ¤í‚¨ì„ í•´ê¸ˆí•˜ì„¸ìš”!'}
          </div>
        </div>
      `;
      
      modal.classList.add('show');
    }

    /* íŒì—… ë‚´ ëª©í‘œ í‘œì‹œ ì¦‰ì‹œ ë°˜ì˜ (ì €ì¥ í›„ í˜¸ì¶œ) */
    function updateStatsPopupGoal() {
      const el = document.getElementById('statsGoalCompleteValue');
      if (el) {
        const percent = dailyGoal.target > 0 
          ? Math.min(Math.floor((dailyGoal.completed / dailyGoal.target) * 100), 100)
          : 0;
        el.textContent = `${dailyGoal.completed}/${dailyGoal.target} (${percent}%)`;
      }
      let achievedDiv = document.getElementById('statsGoalAchievedMsg');
      if (dailyGoal.achieved || dailyGoal.completed >= dailyGoal.target) {
        if (!achievedDiv) {
          achievedDiv = document.createElement('div');
          achievedDiv.id = 'statsGoalAchievedMsg';
          achievedDiv.className = 'stats-item';
          achievedDiv.style.cssText = 'color: #ffcc00; font-weight: bold;';
          achievedDiv.textContent = 'âœ¨ ì˜¤ëŠ˜ ëª©í‘œ ë‹¬ì„±!';
          const goalSection = document.getElementById('statsContent')?.querySelector('.stats-section');
          const lastItem = goalSection?.querySelector('.stats-item:last-of-type');
          if (lastItem) lastItem.after(achievedDiv);
        }
      } else if (achievedDiv) {
        achievedDiv.remove();
      }
    }

    /* ëª©í‘œ ì €ì¥ */
    function saveGoal() {
      const input = document.getElementById('goalInput');
      if(input) {
        const newTarget = parseInt(input.value) || 5;
        if(newTarget >= 1 && newTarget <= 50) {
          const wasAchieved = dailyGoal.achieved;
          dailyGoal.target = newTarget;
          
          // ëª©í‘œ ë‹¬ì„± ìƒíƒœ ì¬ê³„ì‚°
          if(dailyGoal.completed >= dailyGoal.target) {
            if(!wasAchieved) {
              // ìƒˆë¡œ ë‹¬ì„±í•œ ê²½ìš°ì—ë§Œ íš¨ê³¼ í‘œì‹œ
              dailyGoal.achieved = true;
              showGoalAchievedEffect();
              log(`ğŸ¯ ëª©í‘œ ë‹¬ì„±! (ëª©í‘œ ë³€ê²½ìœ¼ë¡œ ë‹¬ì„±)`);
            } else {
              dailyGoal.achieved = true;
            }
          } else {
            dailyGoal.achieved = false;
          }
          
          saveDailyGoal();
          updateGoalUI();
          updateStatsPopupGoal(); /* íŒì—… ë‚´ ëª©í‘œ í‘œì‹œ ì¦‰ì‹œ ë°˜ì˜ */
          log(`ğŸ¯ ì¼ì¼ ëª©í‘œê°€ ${newTarget}ê°œë¡œ 
          ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
      }
    }

    /* ëª©í‘œ ë‹¬ì„± íš¨ê³¼ */
    function showGoalAchievedEffect() {
      // í•˜ë£¨ì¹˜ì— íŠ¹ë³„ íš¨ê³¼
      hamster.classList.add('levelup');
      setTimeout(() => {
        hamster.classList.remove('levelup');
      }, 1000);

      // í™”ë©´ í”Œë˜ì‹œ íš¨ê³¼ (ë ˆë²¨ì—…ë³´ë‹¤ ë¶€ë“œëŸ½ê²Œ)
      const flash = document.createElement('div');
      flash.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(255,204,0,0.3) 0%, transparent 70%);
        pointer-events: none;
        z-index: 400;
        animation: fadeOut 0.8s ease-out forwards;
      `;
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 800);
    }

    function closeStats() {
      const modal = document.getElementById('statsModal');
      modal.classList.remove('show');
    }

    /* ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸° */
    document.addEventListener('click', function(e) {
      if(e.target === document.getElementById('statsModal')) closeStats();
      if(e.target === document.getElementById('logModal')) closeLogModal();
    });

    /* í‚¤ë³´ë“œ 'S' í‚¤ë¡œ í†µê³„ ì—´ê¸°, Escapeë¡œ ëª¨ë‹¬ ë‹«ê¸° */
    document.addEventListener('keydown', function(e) {
      if(e.key === 's' || e.key === 'S') {
        const activeElement = document.activeElement;
        if(activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
          showStats();
        }
      }
      if(e.key === 'Escape') {
        closeStats();
        closeLogModal();
      }
    });

    /* ë ˆë²¨ë³„ ì¹­í˜¸ ì‹œìŠ¤í…œ */
    function getTitleByLevel(level) {
      if(level >= 1000) return "ğŸŒŒ ìš°ì£¼ê¸‰ ì„±ì¥ ë§ˆìŠ¤í„°";
      if(level >= 500) return "ğŸŒŸ ì „ì„¤ì˜ ì„±ì¥ì™•";
      if(level >= 300) return "ğŸ’ ë‹¤ì´ì•„ëª¬ë“œ ì„±ì¥ê°€";
      if(level >= 200) return "ğŸ‘‘ í”Œë˜í‹°ë„˜ ë§ˆìŠ¤í„°";
      if(level >= 150) return "ğŸ† ê³¨ë“œ ì±”í”¼ì–¸";
      if(level >= 100) return "â­ ê³¨ë“œ ì„±ì¥ê°€";
      if(level >= 80) return "ğŸ”¥ ì—´ì •ì˜ ë§ˆìŠ¤í„°";
      if(level >= 60) return "ğŸ’ª ìŠµê´€ì˜ ë‹¬ì¸";
      if(level >= 50) return "ğŸ¯ ëª©í‘œ ë‹¬ì„± ì „ë¬¸ê°€";
      if(level >= 40) return "ğŸ“š ì§€ì‹ì˜ ìˆ˜ì§‘ê°€";
      if(level >= 30) return "ğŸ¯ ëª©í‘œ ë‹¬ì„±ì";
      if(level >= 25) return "ğŸ“Š ì„±ì¥ ê¸°ë¡ê°€";
      if(level >= 20) return "âœ¨ ì„±ì¥í•˜ëŠ” ë¦¬ë”";
      if(level >= 17) return "ğŸƒ ê¾¸ì¤€í•¨ì˜ ì¦ëª…ì";
      if(level >= 15) return "ğŸ’ª ë…¸ë ¥í•˜ëŠ” í•˜ë£¨ì¹˜";
      if(level >= 12) return "ğŸ“ ìŠµê´€ ë§Œë“¤ê¸° ì¤‘";
      if(level >= 10) return "ğŸ“ˆ ì„±ì¥ ì¤‘ì¸ í•˜ë£¨ì¹˜";
      if(level >= 7) return "ğŸŒ¿ ì¡°ê¸ˆì”© ìë¼ëŠ” ì¤‘";
      if(level >= 5) return "ğŸŒ± ìƒˆì‹¹ í•˜ë£¨ì¹˜";
      return "ğŸ¹ ìƒˆë‚´ê¸° í•˜ë£¨ì¹˜";
    }

    function updateUI() {
      uiLevel.innerText = game.level;
      const pct = Math.min(100, (game.exp / game.maxExp) * 100);
      uiExp.style.width = `${pct}%`;
      expText.innerText = `${Math.floor(pct)}%`;
      
      // ì¹­í˜¸ ì—…ë°ì´íŠ¸
      const title = getTitleByLevel(game.level);
      const titleElement = document.getElementById('hamsterTitle');
      if(titleElement) {
        titleElement.textContent = title;
      }
      
      // ëª©í‘œ UI ì—…ë°ì´íŠ¸
      updateGoalUI();
    }

    function addToLogHistory(msg, kind, category, xp, date) {
      const now = new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', dateStyle: 'short', timeStyle: 'short' });
      logHistory.unshift({
        msg,
        kind: kind || 'normal',
        category: category || null,
        xp: xp != null ? xp : null,
        date: date != null ? date : now
      });
      if (logHistory.length > 200) logHistory.pop();
    }

    /* ìˆ˜ë™ í•  ì¼ ê¸°ë¡ - XP ìƒí•œÂ·ì¼ì¼ 10ê±´ ì œí•œ */
    function addManualTask(name, xp) {
      const count = getDailyManualTaskCount();
      if (count >= MANUAL_TASK_DAILY_LIMIT) {
        log('ğŸ“Œ ì˜¤ëŠ˜ ìˆ˜ë™ ê¸°ë¡ í•œë„(10ê±´)ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.', { kind: 'system' });
        showStats(false);
        return;
      }
      const capped = Math.min(Math.max(5, Math.floor(xp) || 10), MANUAL_TASK_XP_CAP);
      const displayName = (name || 'í•  ì¼').trim() || 'í•  ì¼';
      addToLogHistory(`âœ ${displayName} +${capped} XP`, 'normal', 'ìˆ˜ë™ê¸°ë¡', capped);
      game.exp += capped;
      while (game.exp >= game.maxExp) {
        game.level++;
        game.exp -= game.maxExp;
        logLevelUp(`â­ LEVEL UP! LV.${game.level} â­`);
        showLevelUpEffect();
      }
      saveStats();
      updateStats(capped, true);
      saveDailyManualTaskCount(count + 1);
      updateUI();
      showStats(false);
    }
    function submitManualTaskCustom() {
      const input = document.getElementById('manualTaskName');
      const select = document.getElementById('manualTaskXp');
      const name = (input && input.value.trim()) || 'í•  ì¼';
      const xp = (select && parseInt(select.value, 10)) || 10;
      addManualTask(name, xp);
      if (input) input.value = '';
    }

    function log(msg, opts) {
      opts = opts || {};
      addToLogHistory(msg, opts.kind || 'normal', opts.category || null, opts.xp != null ? opts.xp : null);
      const item = document.createElement('div');
      item.className = 'log-item new' + (opts.category ? ' log-cat-' + opts.category : '');
      item.innerText = `> ${msg}`;
      uiLog.prepend(item);
      if(uiLog.children.length > 20) uiLog.removeChild(uiLog.lastChild);
    }

    function logLevelUp(msg) {
      addToLogHistory(msg, 'level-up', 'ë ˆë²¨ì—…', null);
      const item = document.createElement('div');
      item.className = 'log-item new level-up';
      item.innerText = `> ${msg}`;
      uiLog.prepend(item);
      if(uiLog.children.length > 20) uiLog.removeChild(uiLog.lastChild);
    }

    function logImportant(msg) {
      addToLogHistory(msg, 'important', null, null);
      const item = document.createElement('div');
      item.className = 'log-item new important';
      item.innerText = `> ${msg}`;
      uiLog.prepend(item);
      if(uiLog.children.length > 20) uiLog.removeChild(uiLog.lastChild);
    }

    async function openLogModal() {
      if (NOTION_ENABLED) await fetchAndMergeNotionLogs(); /* ì—´ ë•Œë§ˆë‹¤ ìµœì‹  ë…¸ì…˜ ì™„ë£Œ ë¡œê·¸ ë°˜ì˜ */
      const content = document.getElementById('logModalContent');
      const all = logHistory.length ? logHistory : [
        { msg: 'ì‹œìŠ¤í…œ ê°€ë™..', kind: 'normal', category: null, xp: null, date: null },
        { msg: 'í•˜ë£¨ì¹˜ê°€ ê¸°ë‹¤ë ¤ìš”!', kind: 'normal', category: null, xp: null, date: null }
      ];
      const taskLogs = all.filter(e => e.category && LOG_CATEGORY_TASK.includes(e.category));
      const clickLogs = all.filter(e => e.category && LOG_CATEGORY_CLICK.includes(e.category));
      const otherLogs = all.filter(e => !e.category || (!LOG_CATEGORY_TASK.includes(e.category) && !LOG_CATEGORY_CLICK.includes(e.category)));

      function renderSection(title, entries, sectionClass) {
        if (entries.length === 0) return '';
        return `
          <div class="log-section ${sectionClass}">
            <div class="log-section-title">${title}</div>
            ${entries.map(e => {
              const c = e.kind === 'level-up' ? 'level-up' : e.kind === 'important' ? 'important' : '';
              const tag = e.category ? `<span class="log-cat-tag">${e.category}</span>` : '';
              const xpStr = (e.xp != null && e.msg.indexOf('+' + e.xp) === -1) ? ` <span class="log-xp">+${e.xp} XP</span>` : '';
              const dateStr = e.date ? `<span class="log-date">${e.date}</span>` : '';
              return `<div class="log-line ${c}">${dateStr} ${tag}> ${e.msg}${xpStr}</div>`;
            }).join('')}
          </div>`;
      }

      content.innerHTML =
        (NOTION_ENABLED ? `<div class="log-refresh-wrap"><button onclick="openLogModal()" class="log-refresh-btn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button></div>` : '') +
        renderSection('ğŸ“Œ í• ì¼ ì™„ë£Œ ê²½í—˜ì¹˜ (í• ì¼/ë£¨í‹´/ìš´ë™/ë…ì„œ/ì±…/SNS)', taskLogs, 'log-section-task') +
        renderSection('ğŸ–± í´ë¦­ ê²½í—˜ì¹˜ (ë°¥/ë¬¼/ì“°ë‹¤ë“¬ê¸°)', clickLogs, 'log-section-click') +
        renderSection('ğŸ“‹ ê¸°íƒ€', otherLogs, 'log-section-other');
      document.getElementById('logModal').classList.add('show');
    }

    function closeLogModal() {
      document.getElementById('logModal').classList.remove('show');
    }

    init();
    /* ë…¸ì…˜ ì„ë² ë“œ: ì˜¤í”„ë‹ í™”ë©´ ìƒëµ, ë°”ë¡œ ê²Œì„ í™”ë©´ ì§„ì… */
    if (NOTION_ENABLED) {
      startGame();
    } else {
      /* ê²Œì„ê¸° ë²„ì „: ì˜¤í”„ë‹ í™”ë©´ í‘œì‹œ, í„°ì¹˜ ì‹œ ì¬ìƒ ì‹œì‘ */
      (function() {
        var o = document.getElementById('openingBgm');
        if (o) {
          o.volume = 0.6;
          o.loop = true;
        }
        var startScreen = document.getElementById('startScreen');
        function onFirstTouch() {
          unmuteOpening();
          startScreen.removeEventListener('click', onFirstTouch, true);
          startScreen.removeEventListener('touchstart', onFirstTouch, true);
        }
        if (startScreen) {
          startScreen.addEventListener('click', onFirstTouch, true);
          startScreen.addEventListener('touchstart', onFirstTouch, { passive: true, capture: true });
        }
      })();
    }

    /* ê°œë°œì ë„êµ¬ (ì½˜ì†”ì—ì„œ dev.xxx í˜¸ì¶œ ê°€ëŠ¥) */
    window.dev = {
      addExp: function(amount) { addExp(amount); },
      levelUp: function() { game.exp = game.maxExp; addExp(0); },
      setLevel: function(level) { game.level = level; game.exp = 0; updateUI(); },
      setExp: function(exp) { game.exp = exp; updateUI(); },
      status: function() { console.log(`LV.${game.level} EXP:${game.exp}/${game.maxExp}`); }
    };
  </script>
</body>
</html>